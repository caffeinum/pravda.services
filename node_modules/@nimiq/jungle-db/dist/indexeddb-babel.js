require=function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":21,"../../modules/es6.array.from":84,"../../modules/es6.string.iterator":96}],2:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":83,"../modules/es6.string.iterator":96,"../modules/web.dom.iterable":100}],3:[function(e,t,n){var r=e("../../modules/_core"),o=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(e){return o.stringify.apply(o,arguments)}},{"../../modules/_core":21}],4:[function(e,t,n){e("../../modules/es6.math.clz32"),t.exports=e("../../modules/_core").Math.clz32},{"../../modules/_core":21,"../../modules/es6.math.clz32":86}],5:[function(e,t,n){e("../../modules/es6.math.fround"),t.exports=e("../../modules/_core").Math.fround},{"../../modules/_core":21,"../../modules/es6.math.fround":87}],6:[function(e,t,n){e("../../modules/es6.math.imul"),t.exports=e("../../modules/_core").Math.imul},{"../../modules/_core":21,"../../modules/es6.math.imul":88}],7:[function(e,t,n){e("../../modules/es6.math.trunc"),t.exports=e("../../modules/_core").Math.trunc},{"../../modules/_core":21,"../../modules/es6.math.trunc":89}],8:[function(e,t,n){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":21,"../../modules/es6.number.is-integer":90}],9:[function(e,t,n){e("../../modules/es6.number.max-safe-integer"),t.exports=9007199254740991},{"../../modules/es6.number.max-safe-integer":91}],10:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":21,"../../modules/es6.object.freeze":92}],11:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":21,"../../modules/es6.object.keys":93}],12:[function(e,t,n){e("../../modules/es7.object.values"),t.exports=e("../../modules/_core").Object.values},{"../../modules/_core":21,"../../modules/es7.object.values":97}],13:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":21,"../modules/es6.object.to-string":94,"../modules/es6.promise":95,"../modules/es6.string.iterator":96,"../modules/es7.promise.finally":98,"../modules/es7.promise.try":99,"../modules/web.dom.iterable":100}],14:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],15:[function(e,t,n){t.exports=function(){}},{}],16:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],17:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":40}],18:[function(e,t,n){var r=e("./_to-iobject"),o=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,n,s){var a,c=r(t),u=o(c.length),l=i(s,u);if(e&&n!=n){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":74,"./_to-iobject":76,"./_to-length":77}],19:[function(e,t,n){var r=e("./_cof"),o=e("./_wks")("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:i?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":20,"./_wks":81}],20:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],21:[function(e,t,n){var r=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=r)},{}],22:[function(e,t,n){"use strict";var r=e("./_object-dp"),o=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,o(0,n)):e[t]=n}},{"./_object-dp":54,"./_property-desc":64}],23:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":14}],24:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],25:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":29}],26:[function(e,t,n){var r=e("./_is-object"),o=e("./_global").document,i=r(o)&&r(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":31,"./_is-object":40}],27:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],28:[function(e,t,n){var r=e("./_global"),o=e("./_core"),i=e("./_ctx"),s=e("./_hide"),a=e("./_has"),c=function(e,t,n){var u,l,f,h=e&c.F,_=e&c.G,d=e&c.S,p=e&c.P,y=e&c.B,m=e&c.W,g=_?o:o[t]||(o[t]={}),b=g.prototype,v=_?r:d?r[t]:(r[t]||{}).prototype;for(u in _&&(n=t),n)(l=!h&&v&&void 0!==v[u])&&a(g,u)||(f=l?v[u]:n[u],g[u]=_&&"function"!=typeof v[u]?n[u]:y&&l?i(f,r):m&&v[u]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):p&&"function"==typeof f?i(Function.call,f):f,p&&((g.virtual||(g.virtual={}))[u]=f,e&c.R&&b&&!b[u]&&s(b,u,f)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},{"./_core":21,"./_ctx":23,"./_global":31,"./_has":32,"./_hide":33}],29:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],30:[function(e,t,n){var r=e("./_ctx"),o=e("./_iter-call"),i=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),c=e("./core.get-iterator-method"),u={},l={};(n=t.exports=function(e,t,n,f,h){var _,d,p,y,m=h?function(){return e}:c(e),g=r(n,f,t?2:1),b=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(i(m)){for(_=a(e.length);_>b;b++)if((y=t?g(s(d=e[b])[0],d[1]):g(e[b]))===u||y===l)return y}else for(p=m.call(e);!(d=p.next()).done;)if((y=o(p,g,d.value,t))===u||y===l)return y}).BREAK=u,n.RETURN=l},{"./_an-object":17,"./_ctx":23,"./_is-array-iter":38,"./_iter-call":41,"./_to-length":77,"./core.get-iterator-method":82}],31:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],32:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],33:[function(e,t,n){var r=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":25,"./_object-dp":54,"./_property-desc":64}],34:[function(e,t,n){var r=e("./_global").document;t.exports=r&&r.documentElement},{"./_global":31}],35:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":25,"./_dom-create":26,"./_fails":29}],36:[function(e,t,n){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],37:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":20}],38:[function(e,t,n){var r=e("./_iterators"),o=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||i[o]===e)}},{"./_iterators":46,"./_wks":81}],39:[function(e,t,n){var r=e("./_is-object"),o=Math.floor;t.exports=function(e){return!r(e)&&isFinite(e)&&o(e)===e}},{"./_is-object":40}],40:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],41:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var i=e["return"];throw void 0!==i&&r(i.call(e)),t}}},{"./_an-object":17}],42:[function(e,t,n){"use strict";var r=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(s,{next:o(1,n)}),i(e,t+" Iterator")}},{"./_hide":33,"./_object-create":53,"./_property-desc":64,"./_set-to-string-tag":68,"./_wks":81}],43:[function(e,t,n){"use strict";var r=e("./_library"),o=e("./_export"),i=e("./_redefine"),s=e("./_hide"),a=e("./_iterators"),c=e("./_iter-create"),u=e("./_set-to-string-tag"),l=e("./_object-gpo"),f=e("./_wks")("iterator"),h=!([].keys&&"next"in[].keys()),_=function(){return this};t.exports=function(e,t,n,d,p,y,m){c(n,t,d);var g,b,v,S=function(e){if(!h&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",k="values"==p,T=!1,E=e.prototype,x=E[f]||E["@@iterator"]||p&&E[p],O=x||S(p),j=p?k?S("entries"):O:void 0,B="Array"==t&&E.entries||x;if(B&&(v=l(B.call(new e)))!==Object.prototype&&v.next&&(u(v,w,!0),r||"function"==typeof v[f]||s(v,f,_)),k&&x&&"values"!==x.name&&(T=!0,O=function(){return x.call(this)}),r&&!m||!h&&!T&&E[f]||s(E,f,O),a[t]=O,a[w]=_,p)if(g={values:k?O:S("values"),keys:y?O:S("keys"),entries:j},m)for(b in g)b in E||i(E,b,g[b]);else o(o.P+o.F*(h||T),t,g);return g}},{"./_export":28,"./_hide":33,"./_iter-create":42,"./_iterators":46,"./_library":47,"./_object-gpo":56,"./_redefine":66,"./_set-to-string-tag":68,"./_wks":81}],44:[function(e,t,n){var r=e("./_wks")("iterator"),o=!1;try{var i=[7][r]();i["return"]=function(){o=!0},Array.from(i,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i=[7],s=i[r]();s.next=function(){return{done:n=!0}},i[r]=function(){return s},e(i)}catch(e){}return n}},{"./_wks":81}],45:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],46:[function(e,t,n){t.exports={}},{}],47:[function(e,t,n){t.exports=!0},{}],48:[function(e,t,n){var r=e("./_math-sign"),o=Math.pow,i=o(2,-52),s=o(2,-23),a=o(2,127)*(2-s),c=o(2,-126);t.exports=Math.fround||function(e){var t,n,o=Math.abs(e),u=r(e);return o<c?u*(o/c/s+1/i-1/i)*c*s:(n=(t=(1+s/i)*o)-(t-o))>a||n!=n?u*(1/0):u*n}},{"./_math-sign":49}],49:[function(e,t,n){t.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],50:[function(e,t,n){var r=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),s=e("./_object-dp").f,a=0,c=Object.isExtensible||function(){return!0},u=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=t.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return u&&f.NEED&&c(e)&&!i(e,r)&&l(e),e}}},{"./_fails":29,"./_has":32,"./_is-object":40,"./_object-dp":54,"./_uid":80}],51:[function(e,t,n){var r=e("./_global"),o=e("./_task").set,i=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,c="process"==e("./_cof")(s);t.exports=function(){var e,t,n,u=function(){var r,o;for(c&&(r=s.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){s.nextTick(u)};else if(!i||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var l=a.resolve();n=function(){l.then(u)}}else n=function(){o.call(r,u)};else{var f=!0,h=document.createTextNode("");new i(u).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,n()),t=o}}},{"./_cof":20,"./_global":31,"./_task":73}],52:[function(e,t,n){"use strict";var r=e("./_a-function");t.exports.f=function(e){return new function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}(e)}},{"./_a-function":14}],53:[function(e,t,n){var r=e("./_an-object"),o=e("./_object-dps"),i=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},c=function(){var t,n=e("./_dom-create")("iframe"),r=i.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;r--;)delete c.prototype[i[r]];return c()};t.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=c(),void 0===t?n:o(n,t)}},{"./_an-object":17,"./_dom-create":26,"./_enum-bug-keys":27,"./_html":34,"./_object-dps":55,"./_shared-key":69}],54:[function(e,t,n){var r=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":17,"./_descriptors":25,"./_ie8-dom-define":35,"./_to-primitive":79}],55:[function(e,t,n){var r=e("./_object-dp"),o=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){o(e);for(var n,s=i(t),a=s.length,c=0;a>c;)r.f(e,n=s[c++],t[n]);return e}},{"./_an-object":17,"./_descriptors":25,"./_object-dp":54,"./_object-keys":58}],56:[function(e,t,n){var r=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":32,"./_shared-key":69,"./_to-object":78}],57:[function(e,t,n){var r=e("./_has"),o=e("./_to-iobject"),i=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,a=o(e),c=0,u=[];for(n in a)n!=s&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~i(u,n)||u.push(n));return u}},{"./_array-includes":18,"./_has":32,"./_shared-key":69,"./_to-iobject":76}],58:[function(e,t,n){var r=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,o)}},{"./_enum-bug-keys":27,"./_object-keys-internal":57}],59:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],60:[function(e,t,n){var r=e("./_export"),o=e("./_core"),i=e("./_fails");t.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",s)}},{"./_core":21,"./_export":28,"./_fails":29}],61:[function(e,t,n){var r=e("./_object-keys"),o=e("./_to-iobject"),i=e("./_object-pie").f;t.exports=function(e){return function(t){for(var n,s=o(t),a=r(s),c=a.length,u=0,l=[];c>u;)i.call(s,n=a[u++])&&l.push(e?[n,s[n]]:s[n]);return l}}},{"./_object-keys":58,"./_object-pie":59,"./_to-iobject":76}],62:[function(e,t,n){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],63:[function(e,t,n){var r=e("./_an-object"),o=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},{"./_an-object":17,"./_is-object":40,"./_new-promise-capability":52}],64:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],65:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},{"./_hide":33}],66:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":33}],67:[function(e,t,n){"use strict";var r=e("./_global"),o=e("./_core"),i=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];s&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":21,"./_descriptors":25,"./_global":31,"./_object-dp":54,"./_wks":81}],68:[function(e,t,n){var r=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},{"./_has":32,"./_object-dp":54,"./_wks":81}],69:[function(e,t,n){var r=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return r[e]||(r[e]=o(e))}},{"./_shared":70,"./_uid":80}],70:[function(e,t,n){var r=e("./_global"),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./_global":31}],71:[function(e,t,n){var r=e("./_an-object"),o=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[i])?t:o(n)}},{"./_a-function":14,"./_an-object":17,"./_wks":81}],72:[function(e,t,n){var r=e("./_to-integer"),o=e("./_defined");t.exports=function(e){return function(t,n){var i,s,a=String(o(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(i=a.charCodeAt(c))<55296||i>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):i:e?a.slice(c,c+2):s-56320+(i-55296<<10)+65536}}},{"./_defined":24,"./_to-integer":75}],73:[function(e,t,n){var r,o,i,s=e("./_ctx"),a=e("./_invoke"),c=e("./_html"),u=e("./_dom-create"),l=e("./_global"),f=l.process,h=l.setImmediate,_=l.clearImmediate,d=l.MessageChannel,p=l.Dispatch,y=0,m={},g=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},b=function(e){g.call(e.data)};h&&_||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++y]=function(){a("function"==typeof e?e:Function(e),t)},r(y),y},_=function(e){delete m[e]},"process"==e("./_cof")(f)?r=function(e){f.nextTick(s(g,e,1))}:p&&p.now?r=function(e){p.now(s(g,e,1))}:d?(i=(o=new d).port2,o.port1.onmessage=b,r=s(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(s(g,e,1),0)}),t.exports={set:h,clear:_}},{"./_cof":20,"./_ctx":23,"./_dom-create":26,"./_global":31,"./_html":34,"./_invoke":36}],74:[function(e,t,n){var r=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return(e=r(e))<0?o(e+t,0):i(e,t)}},{"./_to-integer":75}],75:[function(e,t,n){var r=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:r)(e)}},{}],76:[function(e,t,n){var r=e("./_iobject"),o=e("./_defined");t.exports=function(e){return r(o(e))}},{"./_defined":24,"./_iobject":37}],77:[function(e,t,n){var r=e("./_to-integer"),o=Math.min;t.exports=function(e){return e>0?o(r(e),9007199254740991):0}},{"./_to-integer":75}],78:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":24}],79:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":40}],80:[function(e,t,n){var r=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+o).toString(36))}},{}],81:[function(e,t,n){var r=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,s="function"==typeof i;(t.exports=function(e){return r[e]||(r[e]=s&&i[e]||(s?i:o)("Symbol."+e))}).store=r},{"./_global":31,"./_shared":70,"./_uid":80}],82:[function(e,t,n){var r=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||i[r(e)]}},{"./_classof":19,"./_core":21,"./_iterators":46,"./_wks":81}],83:[function(e,t,n){var r=e("./_an-object"),o=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":17,"./_core":21,"./core.get-iterator-method":82}],84:[function(e,t,n){"use strict";var r=e("./_ctx"),o=e("./_export"),i=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),c=e("./_to-length"),u=e("./_create-property"),l=e("./core.get-iterator-method");o(o.S+o.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,o,f,h=i(e),_="function"==typeof this?this:Array,d=arguments.length,p=d>1?arguments[1]:void 0,y=void 0!==p,m=0,g=l(h);if(y&&(p=r(p,d>2?arguments[2]:void 0,2)),void 0==g||_==Array&&a(g))for(n=new _(t=c(h.length));t>m;m++)u(n,m,y?p(h[m],m):h[m]);else for(f=g.call(h),n=new _;!(o=f.next()).done;m++)u(n,m,y?s(f,p,[o.value,m],!0):o.value);return n.length=m,n}})},{"./_create-property":22,"./_ctx":23,"./_export":28,"./_is-array-iter":38,"./_iter-call":41,"./_iter-detect":44,"./_to-length":77,"./_to-object":78,"./core.get-iterator-method":82}],85:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":15,"./_iter-define":43,"./_iter-step":45,"./_iterators":46,"./_to-iobject":76}],86:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},{"./_export":28}],87:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{fround:e("./_math-fround")})},{"./_export":28,"./_math-fround":48}],88:[function(e,t,n){var r=e("./_export"),o=Math.imul;r(r.S+r.F*e("./_fails")(function(){return-5!=o(4294967295,5)||2!=o.length}),"Math",{imul:function(e,t){var n=+e,r=+t,o=65535&n,i=65535&r;return 0|o*i+((65535&n>>>16)*i+o*(65535&r>>>16)<<16>>>0)}})},{"./_export":28,"./_fails":29}],89:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},{"./_export":28}],90:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":28,"./_is-integer":39}],91:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":28}],92:[function(e,t,n){var r=e("./_is-object"),o=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(o(t)):t}})},{"./_is-object":40,"./_meta":50,"./_object-sap":60}],93:[function(e,t,n){var r=e("./_to-object"),o=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return o(r(e))}})},{"./_object-keys":58,"./_object-sap":60,"./_to-object":78}],94:[function(e,t,n){},{}],95:[function(e,t,n){"use strict";var r,o,i,s,a=e("./_library"),c=e("./_global"),u=e("./_ctx"),l=e("./_classof"),f=e("./_export"),h=e("./_is-object"),_=e("./_a-function"),d=e("./_an-instance"),p=e("./_for-of"),y=e("./_species-constructor"),m=e("./_task").set,g=e("./_microtask")(),b=e("./_new-promise-capability"),v=e("./_perform"),S=e("./_promise-resolve"),w=c.TypeError,k=c.process,T=c.Promise,E="process"==l(k),x=function(){},O=o=b.f,j=!!function(){try{var t=T.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(x,x)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(x)instanceof n}catch(e){}}(),B=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,o=1==e._s,i=0,s=function(t){var n,i,s,a=o?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{a?(o||(2==e._h&&R(e),e._h=1),!0===a?n=r:(l&&l.enter(),n=a(r),l&&(l.exit(),s=!0)),n===t.promise?u(w("Promise-chain cycle")):(i=B(n))?i.call(n,c,u):c(n)):u(r)}catch(e){l&&!s&&l.exit(),u(e)}};n.length>i;)s(n[i++]);e._c=[],e._n=!1,t&&!e._h&&C(e)})}},C=function(e){m.call(c,function(){var t,n,r,o=e._v,i=L(e);if(i&&(t=v(function(){E?k.emit("unhandledRejection",o,e):(n=c.onunhandledrejection)?n({promise:e,reason:o}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",o)}),e._h=E||L(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},R=function(e){m.call(c,function(){var t;E?k.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},P=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},N=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");(t=B(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,u(N,r,1),u(P,r,1))}catch(e){P.call(r,e)}}):(n._v=e,n._s=1,A(n,!1))}catch(e){P.call({_w:n,_d:!1},e)}}};j||(T=function(e){d(this,T,"Promise","_h"),_(e),r.call(this);try{e(u(N,this,1),u(P,this,1))}catch(e){P.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(T.prototype,{then:function(e,t){var n=O(y(this,T));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=E?k.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},"catch":function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=u(N,e,1),this.reject=u(P,e,1)},b.f=O=function(e){return e===T||e===s?new i(e):o(e)}),f(f.G+f.W+f.F*!j,{Promise:T}),e("./_set-to-string-tag")(T,"Promise"),e("./_set-species")("Promise"),s=e("./_core").Promise,f(f.S+f.F*!j,"Promise",{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(a||!j),"Promise",{resolve:function(e){return S(a&&this===s?T:this,e)}}),f(f.S+f.F*!(j&&e("./_iter-detect")(function(e){T.all(e)["catch"](x)})),"Promise",{all:function(e){var t=this,n=O(t),r=n.resolve,o=n.reject,i=v(function(){var n=[],i=0,s=1;p(e,!1,function(e){var a=i++,c=!1;n.push(void 0),s++,t.resolve(e).then(function(e){c||(c=!0,n[a]=e,--s||r(n))},o)}),--s||r(n)});return i.e&&o(i.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,o=v(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}})},{"./_a-function":14,"./_an-instance":16,"./_classof":19,"./_core":21,"./_ctx":23,"./_export":28,"./_for-of":30,"./_global":31,"./_is-object":40,"./_iter-detect":44,"./_library":47,"./_microtask":51,"./_new-promise-capability":52,"./_perform":62,"./_promise-resolve":63,"./_redefine-all":65,"./_set-species":67,"./_set-to-string-tag":68,"./_species-constructor":71,"./_task":73,"./_wks":81}],96:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":43,"./_string-at":72}],97:[function(e,t,n){var r=e("./_export"),o=e("./_object-to-array")(!1);r(r.S,"Object",{values:function(e){return o(e)}})},{"./_export":28,"./_object-to-array":61}],98:[function(e,t,n){"use strict";var r=e("./_export"),o=e("./_core"),i=e("./_global"),s=e("./_species-constructor"),a=e("./_promise-resolve");r(r.P+r.R,"Promise",{"finally":function(e){var t=s(this,o.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then(function(){return n})}:e,n?function(n){return a(t,e()).then(function(){throw n})}:e)}})},{"./_core":21,"./_export":28,"./_global":31,"./_promise-resolve":63,"./_species-constructor":71}],99:[function(e,t,n){"use strict";var r=e("./_export"),o=e("./_new-promise-capability"),i=e("./_perform");r(r.S,"Promise",{"try":function(e){var t=o.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},{"./_export":28,"./_new-promise-capability":52,"./_perform":62}],100:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),o=e("./_hide"),i=e("./_iterators"),s=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],l=r[u],f=l&&l.prototype;f&&!f[s]&&o(f,s,u),i[u]=i.Array}},{"./_global":31,"./_hide":33,"./_iterators":46,"./_wks":81,"./es6.array.iterator":85}],101:[function(e,t,n){var r=function(){return this}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},{"./runtime":102}],102:[function(e,t,n){!function(r){"use strict";var o,s=Object.prototype,a=s.hasOwnProperty,c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",f=c.toStringTag||"@@toStringTag",h="object"==typeof t,_=r.regeneratorRuntime;if(_)h&&(t.exports=_);else{(_=r.regeneratorRuntime=h?t.exports:{}).wrap=g;var d="suspendedStart",p="suspendedYield",y="executing",m="completed",b={},v={};v[u]=function(){return this};var B=Object.getPrototypeOf,A=B&&B(B(T([])));A&&A!==s&&a.call(A,u)&&(v=A);var C=k.prototype=x.prototype=Object.create(v);w.prototype=C.constructor=k,k.constructor=w,k[f]=w.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,f in e||(e[f]="GeneratorFunction")),e.prototype=Object.create(C),e},_.awrap=function(e){return{__await:e}},O(S.prototype),S.prototype[l]=function(){return this},_.AsyncIterator=S,_.async=function(e,t,n,r){var o=new S(g(e,t,n,r));return _.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},O(C),C[f]="Generator",C[u]=function(){return this},C.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},_.values=T,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=o)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=o),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),b}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;L(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=o),b}}}function g(e,t,n,r){var o=t&&t.prototype instanceof x?t:x,i=Object.create(o.prototype),s=new P(r||[]);return i._invoke=function(e,t,n){var r=d;return function(o,i){if(r===y)throw new Error("Generator is already running");if(r===m){if("throw"===o)throw i;return F()}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=M(s,n);if(a){if(a===b)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=y;var c=j(e,t,n);if("normal"===c.type){if(r=n.done?m:p,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=m,n.method="throw",n.arg=c.arg)}}}(e,n,s),i}function j(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function w(){}function k(){}function O(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(t){var n;this._invoke=function(e,r){function i(){return new Promise(function(n,o){!function e(n,r,o,i){var s=j(t[n],t,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,o,i)},function(t){e("throw",t,o,i)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},i)}i(s.arg)}(e,r,n,o)})}return n=n?n.then(i,i):i()}}function M(e,t){var n=e.iterator[t.method];if(n===o){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=o,M(e,t),"throw"===t.method))return b;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var r=j(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,b;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=o),t.delegate=null,b):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function T(t){if(t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=o,e.done=!0,e};return i.next=i}}return{next:F}}function F(){return{value:o,done:!0}}}(function(){return this}()||Function("return this")())},{}],"babel-runtime/core-js/array/from":[function(e,t,n){t.exports={"default":e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":1}],"babel-runtime/core-js/get-iterator":[function(e,t,n){t.exports={"default":e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":2}],"babel-runtime/core-js/json/stringify":[function(e,t,n){t.exports={"default":e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":3}],"babel-runtime/core-js/math/clz32":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/clz32"),__esModule:!0}},{"core-js/library/fn/math/clz32":4}],"babel-runtime/core-js/math/fround":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/fround"),__esModule:!0}},{"core-js/library/fn/math/fround":5}],"babel-runtime/core-js/math/imul":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/imul"),__esModule:!0}},{"core-js/library/fn/math/imul":6}],"babel-runtime/core-js/math/trunc":[function(e,t,n){t.exports={"default":e("core-js/library/fn/math/trunc"),__esModule:!0}},{"core-js/library/fn/math/trunc":7}],"babel-runtime/core-js/number/is-integer":[function(e,t,n){t.exports={"default":e("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":8}],"babel-runtime/core-js/number/max-safe-integer":[function(e,t,n){t.exports={"default":e("core-js/library/fn/number/max-safe-integer"),__esModule:!0}},{"core-js/library/fn/number/max-safe-integer":9}],"babel-runtime/core-js/object/freeze":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":10}],"babel-runtime/core-js/object/keys":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":11}],"babel-runtime/core-js/object/values":[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/values"),__esModule:!0}},{"core-js/library/fn/object/values":12}],"babel-runtime/core-js/promise":[function(e,t,n){t.exports={"default":e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":13}],"babel-runtime/helpers/asyncToGenerator":[function(e,t,r){"use strict";r.__esModule=!0;var o,i=(o=e("../core-js/promise"))&&o.__esModule?o:{"default":o};r["default"]=function(e){return function(){var t=e.apply(this,arguments);return new i["default"](function(e,r){return function n(o,s){try{var a=t[o](s),c=a.value}catch(e){return void r(e)}if(!a.done)return i["default"].resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}},{"../core-js/promise":"babel-runtime/core-js/promise"}],"babel-runtime/regenerator":[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":101}]},{},[]);var Proxy,_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}if("undefined"==typeof JDB)var JDB={};!function(e){e="undefined"!=typeof e?e:{};class Class{static register(t){"undefined"!=typeof e&&(e[t.name]=t)}}Class.register(Class);class LogNative{constructor(){this._global_level=Log.TRACE;this._tag_levels={};try{if(window.localStorage)try{let t=window.localStorage.getItem("log_tag_levels");t&&"string"==typeof t&&(t=JSON.parse(t));t&&"object"==typeof t&&(this._tag_levels=t)}catch(e){console.warn("Failed to load log configuration from local storage.")}}catch(e){}}isLoggable(e,t){return e&&this._tag_levels[e]?this._tag_levels[e]<=t:this._tag_levels["*"]?this._tag_levels["*"]<=t:this._global_level<=t}setLoggable(e,t){e&&e.name&&(e=e.name);this._tag_levels[e]=t;window.localStorage&&window.localStorage.setItem("log_tag_levels",JSON.stringify(this._tag_levels))}msg(e,t,n){t&&t.name&&(t=t.name);if(this.isLoggable(t,e)){t&&n.unshift(t+":");n.unshift(`[${Log.Level.toStringTag(e)} ${(new Date).toTimeString().substr(0,8)}]`);console.error&&e>=Log.ERROR?console.error.apply(console,n):console.warn&&e>=Log.WARNING?console.warn.apply(console,n):console.info&&e>=Log.INFO?console.info.apply(console,n):console.debug&&e>=Log.DEBUG?console.debug.apply(console,n):console.trace&&e<=Log.TRACE?console.trace.apply(console,n):console.log.apply(console,n)}}}Class.register(LogNative);class IDBTools{static convertKeyRange(e){return e instanceof KeyRange?e.exactMatch?IDBKeyRange.only(e.lower):e.lower!==undefined&&e.upper===undefined?IDBKeyRange.lowerBound(e.lower,e.lowerOpen):e.upper!==undefined&&e.lower===undefined?IDBKeyRange.upperBound(e.upper,e.upperOpen):IDBKeyRange.bound(e.lower,e.upper,e.lowerOpen,e.upperOpen):e}}Class.register(IDBTools);class IDBBackend{constructor(e,t,n=null){this._db=e;this._tableName=t;this._indices=new Map;this._indicesToCreate=new Map;this._indicesToDelete=[];this._codec=n}get connected(){return this._db.connected}get _backend(){if(!this.connected)throw new Error("Requires a connected database");return this._db.backend}get indices(){return this._indices}init(e,t,n){for(const{indexName:r,upgradeCondition:o}of this._indicesToDelete)e.indexNames.contains(r)&&(null===o||!0===o||"function"==typeof o&&o(t,n))&&e.deleteIndex(r);this._indicesToDelete=[];for(const[r,{index:o,upgradeCondition:i}]of this._indicesToCreate)if(!e.indexNames.contains(r)&&(null===i||!0===i||"function"==typeof i&&i(t,n))){const t=Array.isArray(o.keyPath)?o.keyPath.join("."):o.keyPath;e.createIndex(r,t,{unique:o.unique,multiEntry:o.multiEntry})}this._indicesToCreate.clear()}decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}get(e,t={}){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=n._backend;return new Promise(function(o,i){const s=r.transaction([n._tableName]).objectStore(n._tableName).get(e);s.onsuccess=function(r){try{o(t&&t.raw?r.target.result:n.decode(r.target.result,e))}catch(s){i(s)}};s.onerror=i})})()}values(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(null!==e&&e instanceof Query)return e.values(n,t);e=IDBTools.convertKeyRange(e);const r=n._backend;return new Promise(function(o,i){const s=[],a=r.transaction([n._tableName],"readonly").objectStore(n._tableName).openCursor(e);a.onsuccess=function(e){const r=e.target.result;if(r){if(null!==t&&s.length>=t){o(s);return}try{s.push(n.decode(r.value,r.primaryKey))}catch(a){i(a)}r["continue"]()}else o(s)};a.onerror=function(){return i(a.error)}})})()}keys(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(null!==e&&e instanceof Query)return e.keys(n,t);e=IDBTools.convertKeyRange(e);const r=n._backend;return new Promise(function(o,i){const s=new Set,a=r.transaction([n._tableName],"readonly").objectStore(n._tableName),c=a.openKeyCursor?a.openKeyCursor(e):a.openCursor(e);c.onsuccess=function(e){const n=e.target.result;if(n){if(null!==t&&s.size>=t){o(s);return}s.add(n.primaryKey);n["continue"]()}else o(s)};c.onerror=function(){return i(c.error)}})})()}keyStream(e,t=!0,n=null){n=IDBTools.convertKeyRange(n);const r=this._backend;return new Promise((o,i)=>{const s=r.transaction([this._tableName],"readonly").objectStore(this._tableName),a=s.openKeyCursor?s.openKeyCursor(n,t?"next":"prev"):s.openCursor(n,t?"next":"prev");a.onsuccess=(t=>{const n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():o()}catch(r){i(r)}else o()});a.onerror=(()=>i(a.error))})}valueStream(e,t=!0,n=null){n=IDBTools.convertKeyRange(n);const r=this._backend;return new Promise((o,i)=>{const s=r.transaction([this._tableName],"readonly").objectStore(this._tableName).openCursor(n,t?"next":"prev");s.onsuccess=(t=>{const n=t.target.result;if(n)try{e(this.decode(n.value,n.primaryKey),n.primaryKey)?n["continue"]():o()}catch(r){i(r)}else o()});s.onerror=(()=>i(s.error))})}maxValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=t._backend;return new Promise(function(r,o){const i=n.transaction([t._tableName],"readonly").objectStore(t._tableName).openCursor(e,"prev");i.onsuccess=function(e){try{const i=e.target.result;r(i?t.decode(i.value,i.primaryKey):undefined)}catch(n){o(n)}};i.onerror=function(){return o(i.error)}})})()}maxKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=t._backend;return new Promise(function(r,o){const i=n.transaction([t._tableName],"readonly").objectStore(t._tableName),s=i.openKeyCursor?i.openKeyCursor(e,"prev"):i.openCursor(e,"prev");s.onsuccess=function(){return r(s.result?s.result.primaryKey:undefined)};s.onerror=function(){return o(s.error)}})})()}minValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=t._backend;return new Promise(function(r,o){const i=n.transaction([t._tableName],"readonly").objectStore(t._tableName).openCursor(e,"next");i.onsuccess=function(e){try{const i=e.target.result;r(i?t.decode(i.value,i.primaryKey):undefined)}catch(n){o(n)}};i.onerror=function(){return o(i.error)}})})()}minKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=t._backend;return new Promise(function(r,o){const i=n.transaction([t._tableName],"readonly").objectStore(t._tableName),s=i.openKeyCursor?i.openKeyCursor(e,"next"):i.openCursor(e,"next");s.onsuccess=function(){return r(s.result?s.result.primaryKey:undefined)};s.onerror=function(){return o(s.error)}})})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=t._backend;return new Promise(function(r,o){let i;(i=e?n.transaction([t._tableName],"readonly").objectStore(t._tableName).count(e):n.transaction([t._tableName],"readonly").objectStore(t._tableName).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return o(i.error)}})})()}index(e){return this._indices.get(e)}get backend(){return this._db.backend}get tableName(){return this._tableName}_apply(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=t._backend;return new Promise(function(r,o){const i=n.transaction([t._tableName],"readwrite"),s=i.objectStore(t._tableName);e._truncated&&s.clear();for(const t of e._removed)s["delete"](t);for(const[n,a]of e._modified)s.put(t.encode(a),n);i.oncomplete=function(){return r(!0)};i.onerror=o;i.onabort=o})})()}truncate(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){const t=e._backend;return new Promise(function(n,r){const o=t.transaction([e._tableName],"readonly").objectStore(e._tableName).clear();o.onsuccess=n;o.onerror=function(){return r(o.error)}})})()}createIndex(e,t,n={}){let{multiEntry:r=!1,upgradeCondition:o=null,unique:i=!1}=n||{};if(this._db.connected)throw new Error("Cannot create index while connected");const s=new PersistentIndex(this,e,t=t||e,r,i);this._indices.set(e,s);this._indicesToCreate.set(e,{index:s,upgradeCondition:o})}deleteIndex(e,t={}){let{upgradeCondition:n=null}=t||{};if(this._db.connected)throw new Error("Cannot delete index while connected");this._indicesToDelete.push({indexName:e,upgradeCondition:n})}close(){return this._db.close()}applyCombined(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=new EncodedTransaction(t._tableName);e._truncated&&n.truncate();for(const t of e._removed)n.remove(t);for(const[r,o]of e._modified)n.put(r,t.encode(o));return n})()}isSynchronous(){return!1}}Class.register(IDBBackend);class JungleDB{constructor(e,t,n={}){if(t<=0)throw new Error("The version provided must not be less or equal to 0");this._databaseDir=e;this._dbVersion=t;this._oldDbVersion=null;this._onUpgradeNeeded=n.onUpgradeNeeded;this._connected=!1;this._objectStores=new Map;this._objectStoreBackends=new Map;this._objectStoresToDelete=[]}get _indexedDB(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB}connect(){if(this._db)return Promise.resolve(this._db);const e=this._indexedDB.open(this._databaseDir,this._dbVersion),t=this;return new Promise((n,r)=>{e.onsuccess=(0,_asyncToGenerator3["default"])(function*(){t._connected=!0;t._db=e.result;null!==t._oldDbVersion&&t._onUpgradeNeeded&&(yield t._onUpgradeNeeded(t._oldDbVersion,t._dbVersion,t));n(e.result)});e.onerror=r;e.onupgradeneeded=(n=>t._initDB(n,e))})}_initDB(e,t){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=e.target.result;for(const{tableName:t,upgradeCondition:o}of n._objectStoresToDelete)r.objectStoreNames.contains(t)&&(null===o||!0===o||"function"==typeof o&&o(e.oldVersion,e.newVersion))&&r.deleteObjectStore(t);n._objectStoresToDelete=[];for(const[o,{backend:i,upgradeCondition:s}]of n._objectStoreBackends){let n;n=!r.objectStoreNames.contains(o)&&(null===s||!0===s||"function"==typeof s&&s(e.oldVersion,e.newVersion))?r.createObjectStore(o):t.transaction.objectStore(o);i.init(n,e.oldVersion,e.newVersion)}n._oldDbVersion=e.oldVersion;n._objectStoreBackends.clear()})()}get backend(){return this._db}get connected(){return this._connected}getObjectStore(e){return this._objectStores.get(e)}static createVolatileObjectStore(e={}){const{codec:t=null}=e||{};return new ObjectStore(new InMemoryBackend("",t),null)}createObjectStore(e,t={}){const{codec:n=null,persistent:r=!0,upgradeCondition:o=null,enableLruCache:i=!0,lruCacheSize:s=CachedBackend.MAX_CACHE_SIZE,rawLruCacheSize:a=0}=t||{};if(this._connected)throw new Error("Cannot create ObjectStore while connected");if(this._objectStores.has(e))return this._objectStores.get(e);let c=null,u=c=r?new IDBBackend(this,e,n):new InMemoryBackend(e,n);r&&i&&(u=new CachedBackend(c,s,a));const l=new ObjectStore(u,this,e);this._objectStores.set(e,l);this._objectStoreBackends.set(e,{backend:c,upgradeCondition:o});return l}deleteObjectStore(e,t={}){let{upgradeCondition:n=null}=t||{};if(this._connected)throw new Error("Cannot delete ObjectStore while connected");this._objectStoresToDelete.push({tableName:e,upgradeCondition:n})}close(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(e._connected){e._connected=!1;e.backend.close()}})()}destroy(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){yield e.close();return new Promise(function(t,n){const r=e._indexedDB.deleteDatabase(e._databaseDir);r.onsuccess=t;r.onerror=n})})()}static commitCombined(e,t,...n){return(0,_asyncToGenerator3["default"])(function*(){if(e instanceof CombinedTransaction){const t=[],n=[],r=[],o=yield Promise.all(e.transactions.map(function(e){return e.objectStore._backend.applyCombined(e)}));for(const e of o){let o=e;Array.isArray(e)||(o=[e]);for(const e of o)if("function"==typeof e)t.push(e);else{n.push(e);r.push(e.tableName)}}const i=null!==e.backend?e.backend.backend:null;return new Promise(function(e,o){if(r.length>0){const s=i.transaction(r,"readwrite");for(const e of n){const t=s.objectStore(e.tableName);e.truncated&&t.clear();for(const n of e.removed)t["delete"](n);for(const[n,r]of e.modified)t.put(r,n)}s.oncomplete=function(){Promise.all(t.map(function(e){return e()})).then(function(){e(!0)})};s.onerror=o;s.onabort=o}else Promise.all(t.map(function(e){return e()})).then(function(){e(!0)})})}n.push(e);n.push(t);if(!n.every(function(e){return e instanceof Transaction}))throw new Error("Invalid arguments supplied");return new CombinedTransaction(...n).commit()})()}toString(){return`JungleDB{name=${this._databaseDir}}`}}JungleDB.JSON_ENCODING={};JungleDB.BINARY_ENCODING={};JungleDB.STRING_ENCODING={};JungleDB.NUMBER_ENCODING={};JungleDB.GENERIC_ENCODING={};Class.register(JungleDB);class PersistentIndex{constructor(e,t,n,r=!1,o=!1){this._objectStore=e;this._indexName=t;this._keyPath=n;this._multiEntry=r;this._unique=o}truncate(){return(0,_asyncToGenerator3["default"])(function*(){})()}get keyPath(){return this._keyPath}get multiEntry(){return this._multiEntry}get unique(){return this._unique}_index(e){return e.transaction([this._objectStore.tableName],"readonly").objectStore(this._objectStore.tableName).index(this._indexName)}values(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const r=yield n._objectStore.backend;return new Promise(function(o,i){const s=[],a=n._index(r).openCursor(e);a.onsuccess=function(e){const r=e.target.result;if(r){if(null!==t&&s.length>=t){o(s);return}try{s.push(n._objectStore.decode(r.value,r.primaryKey))}catch(a){i(a)}r["continue"]()}else o(s)};a.onerror=function(){return i(a.error)}})})()}keys(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const r=yield n._objectStore.backend;return new Promise(function(o,i){const s=new Set,a=n._index(r),c=a.openKeyCursor?a.openKeyCursor(e):a.openCursor(e);c.onsuccess=function(e){const n=e.target.result;if(n){if(null!==t&&s.size>=t){o(s);return}s.add(n.primaryKey);n["continue"]()}else o(s)};c.onerror=function(){return i(c.error)}})})()}maxValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=yield t._objectStore.backend;return new Promise(function(r,o){const i=[];let s=null;const a=t._index(n).openCursor(e,"prev");a.onsuccess=function(e){const n=e.target.result;n&&null===s&&(s=n.key);if(n&&ComparisonUtils.equals(s,n.key)){try{i.push(t._objectStore.decode(n.value,n.primaryKey))}catch(a){o(a)}n["continue"]()}else r(i)};a.onerror=function(){return o(a.error)}})})()}maxKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=yield t._objectStore.backend;return new Promise(function(r,o){const i=new Set;let s=null;const a=t._index(n),c=a.openKeyCursor?a.openKeyCursor(e,"prev"):a.openCursor(e,"prev");c.onsuccess=function(e){const t=e.target.result;t&&null===s&&(s=t.key);if(t&&ComparisonUtils.equals(s,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};c.onerror=function(){return o(c.error)}})})()}minValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=yield t._objectStore.backend;return new Promise(function(r,o){const i=[];let s=null;const a=t._index(n).openCursor(e,"next");a.onsuccess=function(e){const n=e.target.result;n&&null===s&&(s=n.key);if(n&&ComparisonUtils.equals(s,n.key)){try{i.push(t._objectStore.decode(n.value,n.primaryKey))}catch(a){o(a)}n["continue"]()}else r(i)};a.onerror=function(){return o(a.error)}})})()}minKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=yield t._objectStore.backend;return new Promise(function(r,o){const i=new Set;let s=null;const a=t._index(n),c=a.openKeyCursor?a.openKeyCursor(e,"next"):a.openCursor(e,"next");c.onsuccess=function(e){const t=e.target.result;t&&null===s&&(s=t.key);if(t&&ComparisonUtils.equals(s,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};c.onerror=function(){return o(c.error)}})})()}keyStream(e,t=!0,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){n=IDBTools.convertKeyRange(n);const o=yield r._objectStore.backend;return new Promise(function(i,s){const a=r._index(o),c=a.openKeyCursor?a.openKeyCursor(n,t?"next":"prev"):a.openCursor(n,t?"next":"prev");c.onsuccess=function(t){const n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():i()}catch(r){s(r)}else i()};c.onerror=function(){return s(c.error)}})})()}valueStream(e,t=!0,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){n=IDBTools.convertKeyRange(n);const o=yield r._objectStore.backend;return new Promise(function(i,s){const a=r._index(o).openCursor(n,t?"next":"prev");a.onsuccess=function(t){const n=t.target.result;if(n)try{e(r._objectStore.decode(n.value,n.primaryKey),n.primaryKey)?n["continue"]():i()}catch(o){s(o)}else i()};a.onerror=function(){return s(a.error)}})})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e=IDBTools.convertKeyRange(e);const n=yield t._objectStore.backend;return new Promise(function(r,o){let i;(i=e?t._index(n).count(e):t._index(n).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return o(i.error)}})})()}}Class.register(PersistentIndex);Array.prototype.iterator=function(e=!0){let t=e?0:this.length-1;return{next:()=>t>=0&&t<this.length?this[e?t++:t--]:undefined,hasNext:()=>t>=0&&t<this.length,peek:()=>t>=0&&t<this.length?this[t]:undefined}};class Node{constructor(e=[]){this._keys=e}get keys(){return this._keys}}Class.register(Node);class LeafNode extends Node{constructor(e=[],t=[]){if(e.length!==t.length)throw new Error("Keys and records must have the same length");super(e);this._records=t;this.prevLeaf=null;this.nextLeaf=null}get records(){return this._records}isLeaf(){return!0}getItem(e,t){const n=this._keys;if(t===BTree.NEAR_MODE.GE){for(let r=0,o=n.length;r<o;++r)if(ComparisonUtils.compare(e,n[r])<=0)return r}else if(t===BTree.NEAR_MODE.LE){for(let r=n.length-1;r>=0;--r)if(ComparisonUtils.compare(e,n[r])>=0)return r}else for(let r=0,o=n.length;r<o;++r)if(ComparisonUtils.equals(e,n[r]))return r;return-1}addKey(e,t){let n=this._keys.length;for(let r=0,o=n;r<o;++r){if(ComparisonUtils.equals(e,this._keys[r]))return-1;if(ComparisonUtils.compare(e,this._keys[r])<=0){n=r;break}}this._keys.splice(n,0,e);this._records.splice(n,0,t);return n}split(){const e=Math.floor(this._keys.length/2),t=[],n=[];for(let o=0;o<e;++o){t.unshift(this._keys.pop());n.unshift(this._records.pop())}const r=new LeafNode(t,n);r.prevLeaf=this;r.nextLeaf=this.nextLeaf;null!==this.nextLeaf&&(this.nextLeaf.prevLeaf=r);this.nextLeaf=r;return r}merge(e,t,n){for(let o=0,i=e.keys.length;o<i;++o){this._keys.push(e.keys[o]);this._records.push(e.records[o])}this.nextLeaf=e.nextLeaf;null!==e.nextLeaf&&(e.nextLeaf.prevLeaf=this);e.prevLeaf=null;e.nextLeaf=null;let r=t.keys.length-1;for(let o=r;o>=0;--o)if(ComparisonUtils.equals(t.keys[o],n)){r=o;break}t.keys.splice(r,1);t.nodePointers.splice(r+1,1)}}Class.register(LeafNode);class InnerNode extends Node{constructor(e=[],t=[]){super(e);this._nodePointers=t}isLeaf(){return!1}get nodePointers(){return this._nodePointers}getItem(e){const t=this._keys.length;for(let n=0;n<t;++n)if(e<this._keys[n])return n;return this._keys.length}addKey(e,t,n){const r=this._keys.length;let o=r;for(let i=0;i<r;++i)if(ComparisonUtils.compare(e,this._keys[i])<=0){o=i;break}this._keys.splice(o,0,e);this._nodePointers.splice(o,0,t);this._nodePointers[o+1]=n}split(){const e=Math.ceil(this._keys.length/2)-1,t=[this._nodePointers.pop()],n=[];for(let r=e-1;r>=0;--r){n.unshift(this._keys.pop());t.unshift(this._nodePointers.pop())}return new InnerNode(n,t)}merge(e,t,n){const r=t.keys[n];this._keys.push(r);for(let o=0,i=e.keys.length;o<i;++o){this._keys.push(e.keys[o]);this._nodePointers.push(e.nodePointers[o])}this._nodePointers.push(e.nodePointers[e.nodePointers.length-1]);t.keys.splice(n,1);t.nodePointers.splice(n+1,1);return r}}Class.register(InnerNode);class BTree{constructor(e=7){this._root=new LeafNode;this._maxkey=e-1;this._minkyl=Math.floor(e/2);this._minkyn=Math.floor(this._maxkey/2);this._leaf=null;this._item=-1;this._key=null;this._record=null;this._length=0;this._eof=!0;this._found=!1}get length(){return this._length}get currentKey(){return this._key}get currentRecord(){return this._record}insert(e,t){const n=[];this._leaf=this._root;for(;!this._leaf.isLeaf();){n.push(this._leaf);this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.addKey(e,t);this._key=e;this._eof=!1;if(-1===this._item){this._found=!0;this._item=this._leaf.getItem(e,!1);this._record=this._leaf.records[this._item]}else{this._found=!1;this._record=t;this._length++;if(this._leaf.keys.length>this._maxkey){let t=this._leaf,r=this._leaf.split(),o=r.keys[0];this._item=this._leaf.getItem(e,!1);if(-1===this._item){this._leaf=this._leaf.nextLeaf;this._item=this._leaf.getItem(e,!1)}for(;;){if(0===n.length){const e=new InnerNode;e.keys[0]=o;e.nodePointers[0]=t;e.nodePointers[1]=r;this._root=e;break}const e=n.pop();e.addKey(o,t,r);if(e.keys.length<=this._maxkey)break;t=e;r=e.split();o=e.keys.pop()}}}return!this._found}remove(e){if("undefined"==typeof e){if(-1===this._item){this._eof=!0;this._found=!1;return!1}e=this._leaf.keys[this._item]}this._del(e);if(this._found){this.seek(e,BTree.NEAR_MODE.GE);this._found=!0}else{this._item=-1;this._eof=!0;this._key=null;this._record=null}return this._found}seek(e,t=BTree.NEAR_MODE.NONE){this._leaf=this._root;for(;!this._leaf.isLeaf();){this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.getItem(e,t);if(t===BTree.NEAR_MODE.GE&&-1===this._item&&null!==this._leaf.nextLeaf){this._leaf=this._leaf.nextLeaf;this._item=0}if(t===BTree.NEAR_MODE.LE&&-1===this._item&&null!==this._leaf.prevLeaf){this._leaf=this._leaf.prevLeaf;this._item=this._leaf.records.length-1}if(-1===this._item){this._eof=!0;this._key=null;this._found=!1;this._record=null}else{this._eof=!1;this._found=this._leaf.keys[this._item]===e;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return!this._eof}skip(e=1){"number"!=typeof e&&(e=1);-1!==this._item&&null!==this._leaf||(this._eof=!0);if(e>0){for(;!this._eof&&this._leaf.keys.length-this._item-1<e;){e=e-this._leaf.keys.length+this._item;this._leaf=this._leaf.nextLeaf;null===this._leaf?this._eof=!0:this._item=0}this._eof||(this._item=this._item+e)}else{e=-e;for(;!this._eof&&this._item<e;){e=e-this._item-1;this._leaf=this._leaf.prevLeaf;null===this._leaf?this._eof=!0:this._item=this._leaf.keys.length-1}this._eof||(this._item=this._item-e)}if(this._eof){this._item=-1;this._found=!1;this._key=null;this._record=null}else{this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}goto(e){if(e<0){this.goBottom();this._eof||this.skip(e+1)}else{this.goTop();this._eof||this.skip(e-1)}return this._found}keynum(){if(null===this._leaf||-1===this._item)return-1;let e=this._item+1,t=this._leaf;for(;null!==t.prevLeaf;)e+=(t=t.prevLeaf).keys.length;return e}goTop(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[0];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=0;this._eof=!1;this._found=!0;this._key=this._leaf.keys[0];this._record=this._leaf.records[0]}return this._found}goBottom(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[this._leaf.nodePointers.length-1];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=this._leaf.keys.length-1;this._eof=!1;this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}pack(){let e,t;this.goTop(0);if(this._leaf===this._root)return!1;let n=new LeafNode,r=0,o=this._leaf,i=0,s=[],a=[];for(;;){n.keys[r]=o.keys[i];n.records[r]=o.records[i];0===r&&a.push(n);if(i===o.keys.length-1){if(null===o.nextLeaf)break;o=o.nextLeaf;i=0}else i++;if(r===this._maxkey-1){const e=new LeafNode;n.nextLeaf=e;e.prevLeaf=n;n=e;r=0}else r++}let c,u,l=this._minkyl-n.keys.length;o=n.prevLeaf;if(l>0&&null!==o)for(t=l-1;t>=0;--t){n.keys.unshift(o.keys.pop());n.records.unshift(o.records.pop())}for(t=1,e=a.length;t<e;++t)s.push(a[t].keys[0]);s[s.length]=null;for(;null!==s[0];){c=s;u=a;s=[];a=[];r=this._maxkey+1;t=0;e=c.length;for(;t<e;t++){if(r>this._maxkey){n=new InnerNode;r=0;a.push(n)}n.keys[r]=c[t];n.nodePointers[r]=u[t];r++}if((l=this._minkyn-n.keys.length+1)>0&&a.length>1){o=a[a.length-2];for(t=l-1;t>=0;--t){n.keys.unshift(o.keys.pop());n.nodePointers.unshift(o.nodePointers.pop())}}t=0;e=a.length;for(;t<e;++t)s.push(a[t].keys.pop())}this._root=a[0];this.goTop();return this._found}_del(e){const t=[];let n,r=null,o=-1;this._leaf=this._root;for(;!this._leaf.isLeaf();){t.push(this._leaf);r=this._leaf;o=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[o]}this._item=this._leaf.getItem(e,!1);if(-1===this._item){this._found=!1;return}this._found=!0;this._leaf.keys.splice(this._item,1);this._leaf.records.splice(this._item,1);this._length--;if(this._leaf===this._root)return;if(this._leaf.keys.length>=this._minkyl){0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);return}let i=0===o?null:r.nodePointers[o-1];if(null!==i&&i.keys.length>this._minkyl){n=0===this._item?e:this._leaf.keys[0];this._leaf.keys.unshift(i.keys.pop());this._leaf.records.unshift(i.records.pop());BTree._fixNodes(t,n,this._leaf.keys[0]);return}let s=o===r.keys.length?null:r.nodePointers[o+1];if(null!==s&&s.keys.length>this._minkyl){this._leaf.keys.push(s.keys.shift());this._leaf.records.push(s.records.shift());0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);BTree._fixNodes(t,this._leaf.keys[this._leaf.keys.length-1],s.keys[0]);return}if(null!==i){n=0===this._item?e:this._leaf.keys[0];i.merge(this._leaf,r,n);this._leaf=i}else{n=s.keys[0];this._leaf.merge(s,r,n);0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0])}if(1===t.length&&0===r.keys.length){this._root=this._leaf;return}let a,c=t.pop();for(;c.keys.length<this._minkyn&&t.length>0;){if(null!==(s=(a=(r=t.pop()).getItem(n))===r.keys.length?null:r.nodePointers[a+1])&&s.keys.length>this._minkyn){c.keys.push(r.keys[a]);r.keys[a]=s.keys.shift();c.nodePointers.push(s.nodePointers.shift());break}if(null!==(i=0===a?null:r.nodePointers[a-1])&&i.keys.length>this._minkyn){c.keys.unshift(r.keys[a-1]);r.keys[a-1]=i.keys.pop();c.nodePointers.unshift(i.nodePointers.pop());break}if(null!==i){n=i.merge(c,r,a-1);c=i}else null!==s&&(n=c.merge(s,r,a));if(0===t.length&&0===r.keys.length){this._root=c;break}c=r}}static _fixNodes(e,t,n){let r,o=e.length,i=!0;do{for(let s=(r=e[--o].keys).length-1;s>=0;--s)if(r[s]===t){r[s]=n;i=!1;break}}while(i&&o>0)}goToLowerBound(e,t=!1){if(e!==undefined){let n=this.seek(e,BTree.NEAR_MODE.GE);n&&t&&ComparisonUtils.equals(e,this.currentKey)&&(n=this.skip());return n}return this.goTop()}goToUpperBound(e,t=!1){if(e!==undefined){let n=this.seek(e,BTree.NEAR_MODE.LE);n&&t&&ComparisonUtils.equals(e,this.currentKey)&&(n=this.skip(-1));return n}return this.goBottom()}}BTree.NEAR_MODE={NONE:0,LE:1,GE:2};Class.register(BTree);class BufferUtils{static _codePointTextDecoder(e){if("undefined"==typeof TextDecoder)throw new Error("TextDecoder not supported");if(null===BufferUtils._ISO_8859_15_DECODER)throw new Error("TextDecoder does not supprot iso-8859-15");if(BufferUtils._ISO_8859_15_DECODER===undefined)try{BufferUtils._ISO_8859_15_DECODER=new TextDecoder("iso-8859-15")}finally{BufferUtils._ISO_8859_15_DECODER=null}return BufferUtils._ISO_8859_15_DECODER.decode(e).replace("","").replace("","").replace("","").replace("","").replace("","").replace("","").replace("","").replace("","")}static _tripletToBase64(e){return BufferUtils._BASE64_LOOKUP[e>>18&63]+BufferUtils._BASE64_LOOKUP[e>>12&63]+BufferUtils._BASE64_LOOKUP[e>>6&63]+BufferUtils._BASE64_LOOKUP[63&e]}static _base64encodeChunk(e,t,n){let r;const o=[];for(let i=t;i<n;i+=3){r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]);o.push(BufferUtils._tripletToBase64(r))}return o.join("")}static _base64fromByteArray(e){let t;const n=e.length,r=n%3;let o="";const i=[];for(let s=0,a=n-r;s<a;s+=16383)i.push(BufferUtils._base64encodeChunk(e,s,s+16383>a?a:s+16383));if(1===r){t=e[n-1];o+=BufferUtils._BASE64_LOOKUP[t>>2];o+=BufferUtils._BASE64_LOOKUP[t<<4&63];o+="=="}else if(2===r){t=(e[n-2]<<8)+e[n-1];o+=BufferUtils._BASE64_LOOKUP[t>>10];o+=BufferUtils._BASE64_LOOKUP[t>>4&63];o+=BufferUtils._BASE64_LOOKUP[t<<2&63];o+="="}i.push(o);return i.join("")}static toBase64(e){if("undefined"!=typeof Buffer&&"undefined"==typeof window)return Buffer.from(e).toString("base64");if("undefined"!=typeof TextDecoder&&null!==BufferUtils._ISO_8859_15_DECODER)try{return btoa(BufferUtils._codePointTextDecoder(new Uint8Array(e)))}catch(t){}return BufferUtils._base64fromByteArray(new Uint8Array(e))}static fromBase64(e){if(!/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e))throw new Error("Invalid base64");return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}static toBase64lex(e){const t=BufferUtils.toBase64(e);let n="";for(let r=0;r<t.length;r++)n+=BufferUtils.BASE64_TO_BASE64_LEX[t[r]];return n}static fromBase64lex(e){let t="";for(let n=0;n<e.length;n++)t+=BufferUtils.BASE64_LEX_TO_BASE64[e[n]];return BufferUtils.fromBase64(t)}static equals(e,t){if(e.length!==t.length)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let o=0;o<e.length;o++)if(n[o]!==r[o])return!1;return!0}static compare(e,t){if(e.length<t.length)return-1;if(e.length>t.length)return 1;for(let n=0;n<e.length;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}}BufferUtils.BASE64_ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";BufferUtils._BASE64_LOOKUP=[];for(let t=0,n=BufferUtils.BASE64_ALPHABET.length;t<n;++t)BufferUtils._BASE64_LOOKUP[t]=BufferUtils.BASE64_ALPHABET[t];BufferUtils.BASE64_LEX_ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~";BufferUtils.BASE64_TO_BASE64_LEX={"=":"-"};BufferUtils.BASE64_LEX_TO_BASE64={"-":"="};for(let t=0,n=BufferUtils.BASE64_ALPHABET.length;t<n;++t){BufferUtils.BASE64_TO_BASE64_LEX[BufferUtils.BASE64_ALPHABET[t]]=BufferUtils.BASE64_LEX_ALPHABET[t];BufferUtils.BASE64_LEX_TO_BASE64[BufferUtils.BASE64_LEX_ALPHABET[t]]=BufferUtils.BASE64_ALPHABET[t]}Class.register(BufferUtils);class ComparisonUtils{static equals(e,t){return e===t||(e instanceof Set&&t instanceof Set?e.equals(t):!(!ComparisonUtils.isUint8Array(e)||!ComparisonUtils.isUint8Array(t))&&BufferUtils.equals(new Uint8Array(e),new Uint8Array(t)))}static compare(e,t){return ComparisonUtils.isUint8Array(e)&&ComparisonUtils.isUint8Array(t)?BufferUtils.compare(new Uint8Array(e),new Uint8Array(t)):e<t?-1:e>t?1:0}static isUint8Array(e){return"undefined"!=typeof Buffer&&"undefined"==typeof window&&e instanceof Buffer||(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)}}Class.register(ComparisonUtils);class JSONUtils{static stringify(e){return JSON.stringify(e,JSONUtils.jsonifyType)}static parse(e){return JSON.parse(e,JSONUtils.parseType)}static parseType(e,t){if(t&&t[JSONUtils.TYPE_SYMBOL])switch(t[JSONUtils.TYPE_SYMBOL]){case"Uint8Array":return BufferUtils.fromBase64(t[JSONUtils.VALUE_SYMBOL]);case"Set":return Set.from(t[JSONUtils.VALUE_SYMBOL])}return t}static jsonifyType(e,t){return t instanceof Uint8Array?JSONUtils.typedObject("Uint8Array",BufferUtils.toBase64(t)):t instanceof Set?JSONUtils.typedObject("Set",Array.from(t)):t}static typedObject(e,t){const n={};n[JSONUtils.TYPE_SYMBOL]=e;n[JSONUtils.VALUE_SYMBOL]=t;return n}}JSONUtils.TYPE_SYMBOL="__";JSONUtils.VALUE_SYMBOL="value";Class.register(JSONUtils);class Log{static get instance(){Log._instance||(Log._instance=new Log(new LogNative));return Log._instance}constructor(e){this._native=e}setLoggable(e,t){this._native.setLoggable(e,t)}get level(){return this._native._global_level}set level(e){this._native._global_level=e}msg(e,t,n){if(this._native.isLoggable(t,e)){for(let e=0;e<n.length;++e){"function"==typeof n[e]&&(n[e]=n[e]());"object"==typeof n[e]&&("function"==typeof n[e].toString?n[e]=n[e].toString():n[e].constructor&&n[e].constructor.name?n[e]=`{Object: ${n[e].constructor.name}}`:n[e]="{Object}")}this._native.msg(e,t,n)}}static d(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.DEBUG,e,n)}static e(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.ERROR,e,n)}static i(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.INFO,e,n)}static v(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.VERBOSE,e,n)}static w(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.WARNING,e,n)}static t(e,t,...n){if(arguments.length>=2){e=arguments[0];n=Array.prototype.slice.call(arguments,1)}else{e=undefined;n=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.TRACE,e,n)}}Log.Level={TRACE:1,VERBOSE:2,DEBUG:3,INFO:4,WARNING:5,ERROR:6,ASSERT:7,toStringTag:function(e){switch(e){case Log.TRACE:return"T";case Log.VERBOSE:return"V";case Log.DEBUG:return"D";case Log.INFO:return"I";case Log.WARNING:return"W";case Log.ERROR:return"E";case Log.ASSERT:return"A";default:return"*"}}};Log.TRACE=Log.Level.TRACE;Log.VERBOSE=Log.Level.VERBOSE;Log.DEBUG=Log.Level.DEBUG;Log.INFO=Log.Level.INFO;Log.WARNING=Log.Level.WARNING;Log.ERROR=Log.Level.ERROR;Log.ASSERT=Log.Level.ASSERT;Log._instance=null;Log.d.tag=(e=>Log.d.bind(null,e));Log.e.tag=(e=>Log.e.bind(null,e));Log.i.tag=(e=>Log.i.bind(null,e));Log.v.tag=(e=>Log.v.bind(null,e));Log.w.tag=(e=>Log.w.bind(null,e));Log.t.tag=(e=>Log.t.bind(null,e));Class.register(Log);class LinkedList{constructor(...e){this._length=0;this._head=null;this._tail=null;const t=1===e.length&&Array.isArray(e[0])?e[0]:e;for(const n of t)this.push(n)}push(e){const t={next:null,prev:this._head,value:e};this._push(t)}_push(e){this._length++;if(this._head){this._head.next=e;this._head=e}else{this._head=e;this._tail=e}}unshift(e){const t={next:this._tail,prev:null,value:e};this._unshift(t)}_unshift(e){this._length++;if(this._head){this._tail.prev=e;this._tail=e}else{this._head=e;this._tail=e}}pop(){if(!this._head)return null;this._length--;const e=this._head,t=e.prev;if(!t){this._head=null;this._tail=null;return e.value}t.next=null;this._head=t;return e.value}shift(){if(!this._head)return null;this._length--;const e=this._tail,t=e.next;if(!t){this._head=null;this._tail=null;return e.value}t.prev=null;this._tail=t;return e.value}_remove(e){if(e===this._head)this.pop();else if(e===this._tail)this.shift();else{this._length--;e.prev.next=e.next;e.next.prev=e.prev}}clear(){this._length=0;this._head=null;this._tail=null}[Symbol.iterator](){return this.iterator()}*iterator(){let e=this._tail;for(;e;){yield e.value;e=e.next}}isEmpty(){return 0===this._length}get first(){return this._tail?this._tail.value:null}get last(){return this._head?this._head.value:null}get length(){return this._length}}Class.register(LinkedList);class UniqueLinkedList extends LinkedList{constructor(){super();this._map=new Map}push(e){this._map.has(e)||super.push(e)}_push(e){super._push(e);this._map.set(e.value,e)}unshift(e){this._map.has(e)||super.unshift(e)}_unshift(e){super._unshift(e);this._map.set(e.value,e)}pop(){const e=super.pop();this._map["delete"](e);return e}shift(){const e=super.shift();this._map["delete"](e);return e}clear(){super.clear();this._map.clear()}contains(e){return this._map.has(e)}remove(e){const t=this._map.get(e);if(t){super._remove(t);this._map["delete"](e)}}moveBack(e){const t=this._map.get(e);if(t){if(t===this._head)return;if(t===this._tail){t.next.prev=null;this._tail=t.next}else{t.prev.next=t.next;t.next.prev=t.prev}t.next=null;t.prev=this._head;this._head.next=t;this._head=t}else super.push(e)}}Class.register(UniqueLinkedList);class LRUMap{constructor(e){this._maxSize=e;this._map=new Map;this._accessQueue=new UniqueLinkedList}get size(){return this._map.size}clear(){this._accessQueue.clear();return this._map.clear()}"delete"(e){this._accessQueue.remove(e);return this._map["delete"](e)}entries(){return this._map.entries()}forEach(e,t){return this._map.forEach(e,t)}get(e){this._access(e);return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}evict(e=1){for(;e>0&&this._accessQueue.length>0;){const t=this._accessQueue.shift();this._map["delete"](t);--e}}_access(e){this._accessQueue.moveBack(e)}set(e,t){this.size>=this._maxSize&&this.evict();if(this.size<this._maxSize){this._map.set(e,t);this._access(e)}}values(){return this._map.values()}[Symbol.iterator](){return this._map.entries()}}Class.register(LRUMap);class ObjectUtils{static byKeyPath(e,t){if(!Array.isArray(t))return e[t];let n=e;for(const r of t){if(n===undefined)return undefined;n=n[r]}return n}}Class.register(ObjectUtils);Set.prototype.union=function(e){const t=new Set(this);for(const n of e)t.add(n);return t};Set.prototype.intersection=function(e){const t=new Set;for(const n of e)this.has(n)&&t.add(n);return t};Set.prototype.difference=function(e){const t=new Set(this);for(const n of e)t["delete"](n);return t};Set.prototype.equals=function(e){if(this.size!==e.size)return!1;for(const t of e)if(!this.has(t))return!1;return!0};Set.prototype.limit=function(e=null){if(null===e)return this;const t=new Set;let n=0;for(const r of this){if(null!==e&&n>=e)break;t.add(r);n++}return t};Set.from=function(e){return e&&"function"==typeof e[Symbol.iterator]&&"string"!=typeof e?new Set(e):new Set([e])};Set.sampleElement=function(e){return e.size>0?e.values().next().value:undefined};class SortedList{constructor(e=[],t){this._list=e;this._compare=t||SortedList._compare}static _compare(e,t){return e.compare?e.compare(t):e>t?1:e<t?-1:0}indexOf(e){let t=0,n=this._list.length-1,r=null,o=null;for(;t<=n;){r=Math.round((t+n)/2);o=this._list[r];if(this._compare(o,e)<0)t=r+1;else{if(!(this._compare(o,e)>0))return r;n=r-1}}return-1}_insertionIndex(e){let t=0,n=this._list.length-1,r=null,o=null;for(;t<=n;){r=Math.round((t+n)/2);o=this._list[r];if(this._compare(o,e)<0)t=r+1;else{if(!(this._compare(o,e)>0))break;n=r-1}}return t}add(e){this._list.splice(this._insertionIndex(e),0,e)}has(e){return this.indexOf(e)>=0}shift(){return this._list.shift()}pop(){return this._list.pop()}peekFirst(){return this._list[0]}peekLast(){return this._list[this._list.length-1]}remove(e){const t=this.indexOf(e);t>-1&&this._list.splice(t,1)}clear(){this._list=[]}values(){return this._list}[Symbol.iterator](){return this._list[Symbol.iterator]()}copy(){return new SortedList(this._list.slice(),this._compare)}get length(){return this._list.length}}Class.register(SortedList);class Synchronizer{constructor(){this._queue=[];this._working=!1}push(e){return new Promise((t,n)=>{this._queue.push({fn:e,resolve:t,error:n});this._working||this._doWork()["catch"](Log.w.tag(Synchronizer))})}_doWork(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){e._working=!0;for(;e._queue.length;){const n=e._queue.shift();try{const e=yield n.fn();n.resolve(e)}catch(t){n.error&&n.error(t)}}e._working=!1})()}get working(){return this._working}}Class.register(Synchronizer);class EncodedTransaction{constructor(e){this._tableName=e;this._modified=new Map;this._removed=new Set;this._truncated=!1}get tableName(){return this._tableName}get modified(){return this._modified}get removed(){return this._removed}get truncated(){return this._truncated}truncate(){this._truncated=!0;this._modified.clear();this._removed.clear()}put(e,t){this._removed["delete"](e);this._modified.set(e,t)}get(e){return this._modified.get(e)}remove(e){this._removed.add(e);this._modified["delete"](e)}}Class.register(EncodedTransaction);class GenericValueEncoding{static _encodeInteger(e){const t=new Uint8Array(9),n=new DataView(t.buffer);n.setUint8(0,GenericValueEncoding.Type.INTEGER);n.setUint32(1,Math.floor(e/Math.pow(2,32)));n.setUint32(5,e);return t}static _decodeInteger(e){const t=new DataView(e.buffer);return t.getUint32(1)*Math.pow(2,32)+t.getUint32(5)}static _encodeString(e,t=GenericValueEncoding.Type.STRING){const n=new Uint8Array(e.length+1);n[0]=t;for(let r=0;r<e.length;++r)n[r+1]=e.charCodeAt(r);return n}static _decodeString(e){return String.fromCharCode.apply(null,e.subarray(1))}static _encodeOther(e){return GenericValueEncoding._encodeString(JSONUtils.stringify(e),GenericValueEncoding.Type.JSON)}static _decodeOther(e){const t=GenericValueEncoding._decodeString(e);return JSONUtils.parse(t)}static _encodeBuffer(e){const t=new Uint8Array(e.byteLength+1);t[0]=GenericValueEncoding.Type.BUFFER;t.set(e,1);return t}static _decodeBuffer(e){return e.subarray(1)}static encode(e){return Number.isInteger(e)?GenericValueEncoding._encodeInteger(e):"string"==typeof e?this._encodeString(e):e instanceof Uint8Array?GenericValueEncoding._encodeBuffer(e):GenericValueEncoding._encodeOther(e)}static decode(e){switch((e=new Uint8Array(e))[0]){case GenericValueEncoding.Type.INTEGER:return GenericValueEncoding._decodeInteger(e);case GenericValueEncoding.Type.STRING:return GenericValueEncoding._decodeString(e);case GenericValueEncoding.Type.BUFFER:return GenericValueEncoding._decodeBuffer(e);default:return GenericValueEncoding._decodeOther(e)}}static get encoding(){return JungleDB.Encoding.BINARY}}GenericValueEncoding.Type={INTEGER:0,STRING:1,JSON:2,BUFFER:3};Class.register(GenericValueEncoding);class CachedBackend{constructor(e,t=CachedBackend.MAX_CACHE_SIZE,n=0){this._backend=e;this._cache=new LRUMap(t);this._rawCache=new LRUMap(n)}get connected(){return this._backend.connected}get indices(){return this._backend.indices}_retrieveValues(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=[];for(const r of e)n.push(t.get(r));return Promise.all(n)})()}_has(e){return this._cache.has(e)||this._rawCache.has(e)}_get(e,t){if(t&&t.raw){if(this._rawCache.has(e))return this._rawCache.get(e);{const t=this.encode(this._cache.get(e));this._rawCache.set(e,t);return t}}if(this._cache.has(e))return this._cache.get(e);{const t=this.decode(this._rawCache.get(e),e);this._cache.set(e,t);return t}}getSync(e,t={}){if(this._has(e))return this._get(e,t);if(this._backend.isSynchronous()){const n=this._backend.getSync(e,t);t&&t.raw?this._rawCache.set(e,n):this._cache.set(e,n);return n}if(t&&t.expectPresence)throw new Error(`Missing key in cached backend: ${e}`);return undefined}isCached(e){return!1}get(e,t={}){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(n._has(e))return n._get(e,t);const r=yield n._backend.get(e,t);t&&t.raw?n._rawCache.set(e,r):n._cache.set(e,r);return r})()}keys(e=null,t=null){return this._backend.keys(e,t)}values(e=null,t=null){return this._backend.values(e,t)}keyStream(e,t=!0,n=null){return this._backend.keyStream(e,t,n)}valueStream(e,t=!0,n=null){return this._backend.valueStream(e,t,n)}maxValue(e=null){return this._backend.maxValue(e)}maxKey(e=null){return this._backend.maxKey(e)}minKey(e=null){return this._backend.minKey(e)}minValue(e=null){return this._backend.minValue(e)}count(e=null){return this._backend.count(e)}_apply(e){this._applyLocally(e);return this._backend._apply(e)}_applyLocally(e){e._truncated&&this._cache.clear();for(const t of e._removed)this._cache["delete"](t);for(const[t,n]of e._modified)this._cache.set(t,n)}truncate(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){e._cache.clear();return e._backend.truncate()})()}index(e){return this._backend.index(e)}createIndex(e,t,n={}){return this._backend.createIndex(e,t,n)}deleteIndex(e,t={}){return this._backend.deleteIndex(e,t)}close(){return this._backend.close()}applyCombined(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return[yield t._backend.applyCombined(e),function(){return t._applyLocally(e)}]})()}isSynchronous(){return!0}decode(e,t){return this._backend.decode(e,t)}encode(e){return this._backend.encode(e)}}CachedBackend.MAX_CACHE_SIZE=5e3;Class.register(CachedBackend);class InMemoryIndex{constructor(e,t,n=!1,r=!1){this._objectStore=e;this._keyPath=t;this._multiEntry=n;this._unique=r;this._tree=new BTree}truncate(){this._tree=new BTree}_indexKey(e,t){return t===undefined?undefined:this.keyPath?ObjectUtils.byKeyPath(t,this.keyPath):e}get keyPath(){return this._keyPath}get multiEntry(){return this._multiEntry}get unique(){return this._unique}_insert(e,t){const n=this._tree;this._multiEntry&&Array.isArray(t)||(t=[t]);for(const r of t)if(n.seek(r)){if(this._unique)throw new Error(`Uniqueness constraint violated for key ${e} on path ${this._keyPath}`);n.currentRecord.add(e)}else n.insert(r,this._unique?e:new SortedList([e],ComparisonUtils.compare))}put(e,t,n){const r=this._indexKey(e,n),o=this._indexKey(e,t);if(!ComparisonUtils.equals(r,o)){r!==undefined&&this._remove(e,r);o!==undefined&&this._insert(e,o)}}remove(e,t){const n=this._indexKey(e,t);n!==undefined&&this._remove(e,n)}_remove(e,t){const n=this._tree;this._multiEntry&&Array.isArray(t)||(t=[t]);for(const r of t)n.seek(r)&&(!this._unique&&n.currentRecord.length>1?n.currentRecord.remove(e):n.remove(r))}_retrieveValues(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=[];for(const r of e)n.push(t._objectStore.get(r));return Promise.all(n)})()}values(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=yield n.keys(e,t);return n._retrieveValues(r)})()}keys(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){let r=new Set;if(e instanceof KeyRange&&e.exactMatch){n._tree.seek(e.lower)&&(r=Set.from(n._tree.currentRecord));return r.limit(t)}if(e instanceof KeyRange){if(!n._tree.goToLowerBound(e.lower,e.lowerOpen))return r}else if(!n._tree.goTop())return r;for(;(!(e instanceof KeyRange)||e.includes(n._tree.currentKey))&&!(null!==t&&r.size>=t);){r=r.union(Set.from(n._tree.currentRecord));if(!n._tree.skip())break}return r.limit(t)})()}keyStream(e,t=!0,n=null){if(n instanceof KeyRange){if(t){if(!this._tree.goToLowerBound(n.lower,n.lowerOpen))return Promise.resolve()}else if(!this._tree.goToUpperBound(n.upper,n.upperOpen))return Promise.resolve()}else if(t){if(!this._tree.goTop())return Promise.resolve()}else if(!this._tree.goBottom())return Promise.resolve();e:for(;!(n instanceof KeyRange)||n.includes(this._tree.currentKey);){if(this._unique){if(!e(this._tree.currentRecord))break}else{const n=this._tree.currentRecord.values();if(t){for(let t=0;t<n.length;t++)if(!e(n[t]))break e}else for(let t=n.length-1;t>=0;t--)if(!e(n[t]))break e}if(!this._tree.skip(t?1:-1))break}return Promise.resolve()}valueStream(e,t=!0,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){if(n instanceof KeyRange){if(t){if(!r._tree.goToLowerBound(n.lower,n.lowerOpen))return}else if(!r._tree.goToUpperBound(n.upper,n.upperOpen))return}else if(t){if(!r._tree.goTop())return}else if(!r._tree.goBottom())return;e:for(;!(n instanceof KeyRange)||n.includes(r._tree.currentKey);){if(r._unique){if(!e(yield r._objectStore.get(r._tree.currentRecord),r._tree.currentRecord))break}else{const n=r._tree.currentRecord.values();if(t){for(let t=0;t<n.length;t++)if(!e(yield r._objectStore.get(n[t]),n[t]))break e}else for(let t=n.length-1;t>=0;t--)if(!e(yield r._objectStore.get(n[t]),n[t]))break e}if(!r._tree.skip(t?1:-1))break}})()}maxValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.maxKeys(e);return t._retrieveValues(n)})()}maxKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=e instanceof KeyRange;return t._tree.goToUpperBound(n?e.upper:undefined,!!n&&e.upperOpen)?Set.from(t._tree.currentRecord):new Set})()}minValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.minKeys(e);return t._retrieveValues(n)})()}minKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=e instanceof KeyRange;return t._tree.goToLowerBound(n?e.lower:undefined,!!n&&e.lowerOpen)?Set.from(t._tree.currentRecord):new Set})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield t.keys(e)).size})()}}Class.register(InMemoryIndex);class InMemoryBackend{constructor(e,t=null){this._cache=new Map;this._indices=new Map;this._primaryIndex=new InMemoryIndex(this,undefined,!1,!0);this._tableName=e;this._codec=t}get connected(){return!0}get indices(){return this._indices}getSync(e,t={}){const n=this._cache.get(e);return t&&t.raw?n:this.decode(n,e)}get(e,t={}){try{return Promise.resolve(this.getSync(e,t))}catch(n){return Promise.reject(n)}}values(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(null!==e&&e instanceof Query)return e.values(n,t);const r=[];for(const o of yield n.keys(e,t))r.push(yield n.get(o));return Promise.resolve(r)})()}keys(e=null,t=null){return null!==e&&e instanceof Query?e.keys(this,t):this._primaryIndex.keys(e,t)}keyStream(e,t=!0,n=null){return this._primaryIndex.keyStream(e,t,n)}valueStream(e,t=!0,n=null){return this._primaryIndex.valueStream(e,t,n)}maxValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.maxKey(e);return t.get(n)})()}maxKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t._primaryIndex.maxKeys(e);return Set.sampleElement(n)})()}minValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.minKey(e);return t.get(n)})()}minKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t._primaryIndex.minKeys(e);return Set.sampleElement(n)})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield t.keys(e)).size})()}index(e){return this._indices.get(e)}_apply(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){e._truncated&&t.truncateSync();const n=new Map;for(const r of e._removed){const e=t.getSync(r);e&&n.set(r,e);t._cache["delete"](r)}for(const[r,o]of e._modified){const e=t.getSync(r);e&&n.set(r,e);t._cache.set(r,t.encode(o))}InMemoryBackend._indexApply(t._primaryIndex,e,n);for(const r of t._indices.values())InMemoryBackend._indexApply(r,e,n)})()}static _indexApply(e,t,n){t._truncated&&e.truncate();for(const r of t._removed)e.remove(r,n.get(r));for(const[r,o]of t._modified)e.put(r,o,n.get(r))}truncate(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){e.truncateSync()})()}truncateSync(){this._cache.clear();this._primaryIndex.truncate();for(const e of this._indices.values())e.truncate()}map(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){for(const[n,r]of t._cache)e(n,r)})()}createIndex(e,t,n={}){let{multiEntry:r=!1,unique:o=!1,upgradeCondition:i=null}=n||{};const s=new InMemoryIndex(this,t=t||e,r,o);this._indices.set(e,s)}deleteIndex(e,t={}){let{upgradeCondition:n=null}=t||{};this._indices["delete"](e)}decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}get tableName(){return this._tableName}applyCombined(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return function(){return t._apply(e)}})()}isSynchronous(){return!0}isCached(e){return!0}}Class.register(InMemoryBackend);class KeyRange{constructor(e,t,n,r){this._lower=e;this._upper=t;this._lowerOpen=n;this._upperOpen=r}get lower(){return this._lower}get upper(){return this._upper}get lowerOpen(){return this._lowerOpen}get upperOpen(){return this._upperOpen}get exactMatch(){return this._lower===this._upper&&!this._lowerOpen&&!this.upperOpen}includes(e){return(this._lower===undefined||ComparisonUtils.compare(this._lower,e)<0||!this._lowerOpen&&ComparisonUtils.equals(this._lower,e))&&(this._upper===undefined||ComparisonUtils.compare(this._upper,e)>0||!this._upperOpen&&ComparisonUtils.equals(this._upper,e))}static upperBound(e,t=!1){return new KeyRange(undefined,e,!1,t)}static lowerBound(e,t=!1){return new KeyRange(e,undefined,t,!1)}static bound(e,t,n=!1,r=!1){return new KeyRange(e,t,n,r)}static only(e){return new KeyRange(e,e,!1,!1)}}Class.register(KeyRange);class ObjectStore{constructor(e,t,n){this._backend=e;this._db=t;this._name=n;this._stateStack=[];this._backendInfo=new TransactionInfo(this._backend,null);this._transactions=new Map;this._transactions.set(ObjectStore.BACKEND_ID,this._backendInfo);this._snapshotManager=new SnapshotManager;this._synchronizer=new Synchronizer}get jungleDB(){return this._db}get connected(){return this._backend.connected}get _currentState(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].transaction:this._backend}get _currentStateInfo(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1]:this._backendInfo}get _currentStateId(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].id:ObjectStore.BACKEND_ID}get indices(){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.indices}get(e,t={}){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.get(e,t)}put(e,t){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(!n._backend.connected)throw new Error("JungleDB is not connected");const r=n.transaction();try{yield r.put(e,t)}catch(o){yield r.abort();throw o}return r.commit()})()}remove(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(!t._backend.connected)throw new Error("JungleDB is not connected");const n=t.transaction();try{yield n.remove(e)}catch(r){yield n.abort();throw r}return n.commit()})()}getSync(e,t={}){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.getSync(e,t)}isCached(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.isCached(e)}keys(e=null,t=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof Query?e.keys(this._currentState,t):this._currentState.keys(e,t)}values(e=null,t=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof Query?e.values(this._currentState,t):this._currentState.values(e,t)}keyStream(e,t=!0,n=null){return this._currentState.keyStream(e,t,n)}valueStream(e,t=!0,n=null){return this._currentState.valueStream(e,t,n)}maxValue(e=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxValue(e)}maxKey(e=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxKey(e)}minKey(e=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minKey(e)}minValue(e=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minValue(e)}count(e=null){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.count(e)}commit(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(!t._isCommittable(e)){yield t.abort(e);return!1}yield t._commitInternal(e);return!0})()}_isCommittable(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!(e instanceof Transaction&&e.state===Transaction.STATE.OPEN&&this._transactions.has(e.id)))throw new Error("Can only commit open transactions");return this._transactions.get(e.id).isCommittable()}_commitBackend(){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Cannot commit object stores")})()}_commitInternal(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=t._transactions.get(e.id);if(t._stateStack.length>=ObjectStore.MAX_STACK_SIZE){Log.e(ObjectStore,`Transaction stack size exceeded ${t.toStringFull()}`);throw new Error("Transaction stack size exceeded")}t._stateStack.push(n);n.close();n.isFlushable()&&(yield t._flattenState(e))})()}_setParent(e){throw new Error("Unsupported operation")}abort(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(!t._backend.connected)throw new Error("JungleDB is not connected");if(e instanceof Snapshot)return t._snapshotManager.abortSnapshot(e);if(!(e instanceof Transaction&&e.state===Transaction.STATE.OPEN&&t._transactions.has(e.id)))throw new Error("Can only abort open transactions");const n=t._transactions.get(e.id);n.abort();n.parent&&0===n.parent.numOpenChildren&&(yield t._flattenState());t._transactions["delete"](e.id);return!0})()}_flattenState(e){return this._synchronizer.push(()=>this._flattenStateInternal(e))}_flattenStateInternal(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(e&&e instanceof Transaction){const r=t._transactions.get(e.id);if(!r.isFlushable())return!1;const o=r.parent.transaction,i=function(){r.flush();t._transactions["delete"](e.id);const n=t._stateStack.indexOf(r);n>=0&&t._stateStack.splice(n,1);t._flattenState()["catch"](Log.w.tag(ObjectStore))};if(null===e.dependency){r.parent.isBackend()&&(yield t._snapshotManager.applyTx(e,o));try{yield o._apply(e)}catch(n){r.abort();t._transactions["delete"](e.id);const o=t._stateStack.indexOf(r);o>=0&&t._stateStack.splice(o,1);e._setAborted();Log.e(ObjectStore,"Error while applying transaction",n)}i();return!0}return yield e.dependency.onFlushable(e,i,function(){return t._snapshotManager.applyTx(e,o)})}for(;t._stateStack.length>0&&(yield t._flattenStateInternal(t._currentState)););for(;t._stateStack.length>0&&(yield t._flattenStateInternal(t._stateStack[0].transaction)););return!1})()}index(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.index(e)}createIndex(e,t,n={}){return this._backend.createIndex(e,t,n)}deleteIndex(e,t={}){return this._backend.deleteIndex(e,t)}transaction(e=!0){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(this._backend.isSynchronous())return this.synchronousTransaction(e);const t=new Transaction(this,this._currentState,this,e);this._transactions.set(t.id,new TransactionInfo(t,this._currentStateInfo));return t}synchronousTransaction(e=!0){if(!this._backend.connected)throw new Error("JungleDB is not connected");const t=new SynchronousTransaction(this,this._currentState,this,e);this._transactions.set(t.id,new TransactionInfo(t,this._currentStateInfo));return t}isSynchronous(){return this._backend.isSynchronous()}snapshot(){return this._currentStateId!==ObjectStore.BACKEND_ID?this._currentState.snapshot():this._snapshotManager.createSnapshot(this,this._currentState)}_apply(e){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Unsupported operation")})()}truncate(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(!e._backend.connected)throw new Error("JungleDB is not connected");const t=e.transaction();yield t.truncate();return t.commit()})()}close(){if(this._stateStack.length>0)throw new Error("Cannot close database while transactions are active");return this._backend.close()}decode(e,t){return this._backend.decode(e,t)}encode(e){return this._backend.encode(e)}toStringFull(){return`ObjectStore{\n    stack=[${this._stateStack.map(e=>`{tx=${e}, open=${this._openTransactions.get(e.id)?this._openTransactions.get(e.id).size:0}}`)}],\n    db=${this._db}/${this._name?this._name:"unnamed"}\n}`}toString(){return`ObjectStore{stackSize=${this._stateStack.length}, db=${this._db}/${this._name?this._name:"unnamed"}}`}}ObjectStore.MAX_STACK_SIZE=10;ObjectStore.BACKEND_ID="backend";Class.register(ObjectStore);class TransactionInfo{constructor(e,t,n=[]){this.transaction=e;this.children=n;this._parentInfo=t;this._open=!0;this._parentInfo&&this._parentInfo.addChild(this)}addChild(e){this.children.push(e)}removeChild(e){const t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}flush(){if(!this.isBackend()){const e=this.parent;this.parent.removeChild(this);for(const t of this.children.slice())t.parent=e;this.children=[];this._parentInfo=null}}abort(){this.isBackend()||this.parent.removeChild(this)}close(){this._open=!1}get parent(){return this._parentInfo}set parent(e){this.parent.removeChild(this);this._parentInfo=e;this.parent.addChild(this);this.transaction._setParent(e.transaction)}get id(){return this.isBackend()?ObjectStore.BACKEND_ID:this.transaction.id}isBackend(){return null===this._parentInfo}isOpen(){return this._open}get numOpenChildren(){return this.children.filter(e=>e.isOpen()).length}isCommittable(){return this._parentInfo&&this._parentInfo.children.every(e=>e.isOpen())}isFlushable(){return this.parent&&0===this.parent.numOpenChildren&&(null===this.transaction.dependency||this.parent.isBackend())}toString(){return this.transaction.toStringShort()}}class Query{static _parseKeyRange(e,t,n){switch(e){case Query.OPERATORS.GT:return KeyRange.lowerBound(t,!0);case Query.OPERATORS.GE:return KeyRange.lowerBound(t,!1);case Query.OPERATORS.LT:return KeyRange.upperBound(t,!0);case Query.OPERATORS.LE:return KeyRange.upperBound(t,!1);case Query.OPERATORS.EQ:return KeyRange.only(t);case Query.OPERATORS.BETWEEN:return KeyRange.bound(t,n,!0,!0);case Query.OPERATORS.WITHIN:return KeyRange.bound(t,n,!1,!1)}Log.e(`Unknown operator: ${e}`);throw new Error("Unknown operator")}static and(e){const t=Array.from(arguments);return new Query(t,Query.OPERATORS.AND)}static or(e){const t=Array.from(arguments);return new Query(t,Query.OPERATORS.OR)}static max(e){return new Query(e,Query.OPERATORS.MAX)}static min(e){return new Query(e,Query.OPERATORS.MIN)}static lt(e,t){return new Query(e,Query.OPERATORS.LT,t)}static le(e,t){return new Query(e,Query.OPERATORS.LE,t)}static gt(e,t){return new Query(e,Query.OPERATORS.GT,t)}static ge(e,t){return new Query(e,Query.OPERATORS.GE,t)}static eq(e,t){return new Query(e,Query.OPERATORS.EQ,t)}static between(e,t,n){return new Query(e,Query.OPERATORS.BETWEEN,t,n)}static within(e,t,n){return new Query(e,Query.OPERATORS.WITHIN,t,n)}constructor(e,t,n,r){if(Array.isArray(e)){if(e.some(e=>!(e instanceof Query)))throw new Error("Invalid query");if(Query.COMBINED_OPERATORS.indexOf(t)<0)throw new Error("Unknown operator");this._queryType=Query.Type.COMBINED;this._queries=e;this._op=t}else{if(Query.RANGE_OPERATORS.indexOf(t)>=0){this._queryType=Query.Type.RANGE;this._keyRange=Query._parseKeyRange(t,n,r)}else{if(!(Query.ADVANCED_OPERATORS.indexOf(t)>=0))throw new Error("Unknown operator");this._queryType=Query.Type.ADVANCED;this._op=t}this._indexName=e}}values(e,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=yield n._execute(e,t),o=[];for(const t of r)o.push(e.get(t));return Promise.all(o)})()}keys(e,t=null){return this._execute(e,t)}_execute(e,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){switch(n._queryType){case Query.Type.COMBINED:return Promise.resolve(n._executeCombined(e,t));case Query.Type.ADVANCED:return Promise.resolve(n._executeAdvanced(e,t));case Query.Type.RANGE:return n._executeRange(e,t)}return Promise.resolve(new Set)})()}_executeCombined(e,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=[];for(const i of n._queries)r.push(i._execute(e,t));const o=yield Promise.all(r);if(n._op===Query.OPERATORS.AND){if(0===o.length)return new Set;if(1===o.length)return null===t||t>=1?o[0]:new Set;const e=o.shift(),n=new Set;let r=0;for(const i of e)if(o.every(function(e){return e.has(i)})){if(null!==t&&r>=t)break;n.add(i);r++}return n}if(n._op===Query.OPERATORS.OR){const e=new Set;let n=0;for(const r of o){for(const o of r){if(null!==t&&n>=t)break;e.add(o);n++}if(null!==t&&n>=t)break}return e}return new Set})()}_executeAdvanced(e,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=e.index(n._indexName);let o=new Set;switch(n._op){case Query.OPERATORS.MAX:o=yield r.maxKeys();break;case Query.OPERATORS.MIN:o=yield r.minKeys()}return new Set(o.limit(t))})()}_executeRange(e,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=e.index(n._indexName);return new Set(yield r.keys(n._keyRange,t))})()}}Query.OPERATORS={GT:0,GE:1,LT:2,LE:3,EQ:4,BETWEEN:7,WITHIN:8,MAX:9,MIN:10,AND:11,OR:12};Query.RANGE_OPERATORS=[Query.OPERATORS.GT,Query.OPERATORS.GE,Query.OPERATORS.LT,Query.OPERATORS.LE,Query.OPERATORS.EQ,Query.OPERATORS.BETWEEN,Query.OPERATORS.WITHIN];Query.ADVANCED_OPERATORS=[Query.OPERATORS.MAX,Query.OPERATORS.MIN];Query.COMBINED_OPERATORS=[Query.OPERATORS.AND,Query.OPERATORS.OR];Query.Type={RANGE:0,ADVANCED:1,COMBINED:2};Class.register(Query);class TransactionIndex extends InMemoryIndex{static derive(e,t){const n=new Map;for(const[r,o]of t.indices)n.set(r,new TransactionIndex(e,t,r,o.keyPath,o.multiEntry,o.unique));return n}get _index(){return this._backend.index(this._databaseDir)}constructor(e,t,n,r,o=!1,i=!1){super(e,r,o,i);this._backend=t;this._databaseDir=n}checkUniqueConstraint(e,t,n=!0){var r=this;return(0,_asyncToGenerator3["default"])(function*(){if(!r.unique)return;let o=r._indexKey(e,t);if(o!==undefined){r.multiEntry&&Array.isArray(o)||(o=[o]);for(const e of o){if((yield r.count(KeyRange.only(e)))>(n?1:0))throw new Error(`Uniqueness constraint violated for key ${e} on path ${r._keyPath}`)}}})()}keys(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=[];n._objectStore._truncated?r.push(new Set):r.push(n._index.keys(e,t));r.push(InMemoryIndex.prototype.keys.call(n,e,t));let[o,i]=yield Promise.all(r);return(o=(o=o.difference(n._objectStore._removed)).difference(n._objectStore._modified.keys())).union(i).limit(t)})()}values(e=null,t=null){var n=this;return(0,_asyncToGenerator3["default"])(function*(){const r=yield n.keys(e,t);return InMemoryIndex.prototype._retrieveValues.call(n,r)})()}maxValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.maxKeys(e);return InMemoryIndex.prototype._retrieveValues.call(t,n)})()}maxKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){let n;n=t._objectStore._truncated?new Set:yield t._index.maxKeys(e);let r=Set.sampleElement(n),o=undefined,i=undefined;if(r!==undefined){o=yield t._backend.get(r);i=ObjectUtils.byKeyPath(o,t.keyPath)}n=(n=n.difference(t._objectStore._removed)).difference(t._objectStore._modified.keys());for(;r!==undefined&&0===n.size;){const s=KeyRange.upperBound(i,!0);n=yield t._index.maxKeys(s);if((r=Set.sampleElement(n))!==undefined){o=yield t._backend.get(r);i=ObjectUtils.byKeyPath(o,t.keyPath)}n=(n=n.difference(t._objectStore._removed)).difference(t._objectStore._modified.keys());if(i&&null!==e&&!e.includes(i)){n=new Set;break}}const s=yield InMemoryIndex.prototype.maxKeys.call(t,e);if(0===n.size)return s;if(0===s.size)return n;const a=yield t._objectStore.get(Set.sampleElement(s)),c=i,u=ObjectUtils.byKeyPath(a,t.keyPath);return ComparisonUtils.compare(c,u)>0?n:ComparisonUtils.compare(c,u)<0?s:n.union(s)})()}minValues(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.minKeys(e);return InMemoryIndex.prototype._retrieveValues.call(t,n)})()}minKeys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){let n;n=t._objectStore._truncated?new Set:yield t._index.minKeys(e);let r=Set.sampleElement(n),o=undefined,i=undefined;if(r!==undefined){o=yield t._backend.get(r);i=ObjectUtils.byKeyPath(o,t.keyPath)}n=(n=n.difference(t._objectStore._removed)).difference(t._objectStore._modified.keys());for(;r!==undefined&&0===n.size;){const s=KeyRange.lowerBound(i,!0);n=yield t._index.minKeys(s);if((r=Set.sampleElement(n))!==undefined){o=yield t._backend.get(r);i=ObjectUtils.byKeyPath(o,t.keyPath)}n=(n=n.difference(t._objectStore._removed)).difference(t._objectStore._modified.keys());if(i&&null!==e&&!e.includes(i)){n=new Set;break}}const s=yield InMemoryIndex.prototype.minKeys.call(t,e);if(0===n.size)return s;if(0===s.size)return n;const a=yield t._objectStore.get(Set.sampleElement(s)),c=i,u=ObjectUtils.byKeyPath(a,t.keyPath);return ComparisonUtils.compare(c,u)<0?n:ComparisonUtils.compare(c,u)>0?s:n.union(s)})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield t.keys(e)).size})()}}Class.register(TransactionIndex);class Transaction{constructor(e,t,n,r=!0){this._id=Transaction._instanceCount++;this._objectStore=e;this._parent=t;this._managingBackend=n||t;this._modified=new Map;this._removed=new Set;this._truncated=!1;this._indices=TransactionIndex.derive(this,t);this._state=Transaction.STATE.OPEN;this._nested=new Set;this._nestedCommitted=!1;this._dependency=null;this._snapshotManager=new SnapshotManager;this._startTime=Date.now();this._enableWatchdog=r;this._enableWatchdog&&(this._watchdog=setTimeout(()=>{Log.w(Transaction,`Violation: tx id ${this._id} took longer than expected (still open after ${Transaction.WATCHDOG_TIMER/1e3}s), ${this.toString()}.`)},Transaction.WATCHDOG_TIMER))}get objectStore(){return this._objectStore}get nested(){return this._managingBackend instanceof Transaction}get dependency(){return this._dependency}get connected(){return this._managingBackend.connected}get id(){return this._id}get indices(){return this._indices}get state(){return this._state}_applySync(e){e._truncated&&this.truncateSync();for(const[t,n]of e._modified)this._put(t,n);for(const t of e._removed)this._remove(t)}truncate(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){return e.truncateSync()})()}truncateSync(){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._truncated=!0;this._modified.clear();this._removed.clear();for(const e of this._indices.values())e.truncate()}get(e,t={}){var n=this;return(0,_asyncToGenerator3["default"])(function*(){return n._removed.has(e)?undefined:n._modified.has(e)?t&&t.raw?n.encode(n._modified.get(e)):n._modified.get(e):n._truncated?undefined:n._parent.get(e,t)})()}put(e,t){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(n._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");const r=[];for(const o of n._indices.values())r.push(o.checkUniqueConstraint(e,t,!1));yield Promise.all(r);n._put(e,t)})()}putSync(e,t){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._put(e,t)}remove(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(t._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");t._remove(e)})()}removeSync(e){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._remove(e)}keys(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(null!==e&&e instanceof Query)return e.keys(t);let n=new Set;t._truncated||(n=yield t._parent.keys(e));n=n.difference(t._removed);for(const r of t._modified.keys())(null===e||e.includes(r))&&n.add(r);return n})()}values(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(null!==e&&e instanceof Query)return e.values(t);const n=yield t.keys(e),r=[];for(const e of n)r.push(t.get(e));return Promise.all(r)})()}keyStream(e,t=!0,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){let o=Array.from(r._modified.keys());n instanceof KeyRange&&(o=o.filter(function(e){return n.includes(e)}));let i=(o=o.sort()).iterator(t);if(!r._truncated){let o=!1;yield r._parent.keyStream(function(n){for(;i.hasNext()&&(t&&ComparisonUtils.compare(i.peek(),n)<0||!t&&ComparisonUtils.compare(i.peek(),n)>0);){const t=i.next();if(!e(t)){o=!0;return!1}}if(i.hasNext()&&ComparisonUtils.equals(i.peek(),n)){const t=i.next();if(!e(t)){o=!0;return!1}return!0}if(!r._removed.has(n)&&!e(n)){o=!0;return!1}return!0},t,n);if(o)return}for(;i.hasNext()&&e(i.next()););})()}valueStream(e,t=!0,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){let o=Array.from(r._modified.keys());n instanceof KeyRange&&(o=o.filter(function(e){return n.includes(e)}));let i=(o=o.sort()).iterator(t);if(!r._truncated){let o=!1;yield r._parent.valueStream(function(n,s){for(;i.hasNext()&&(t&&ComparisonUtils.compare(i.peek(),s)<0||!t&&ComparisonUtils.compare(i.peek(),s)>0);){const t=i.next(),n=r._modified.get(t);if(!e(n,t)){o=!0;return!1}}if(i.hasNext()&&ComparisonUtils.equals(i.peek(),s)){const t=i.next(),n=r._modified.get(t);if(!e(n,t)){o=!0;return!1}return!0}if(!r._removed.has(s)&&!e(n,s)){o=!0;return!1}return!0},t,n);if(o)return}for(;i.hasNext();){const t=i.next(),n=yield r.get(t);if(!e(n,t))break}})()}maxValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.maxKey(e);return t.get(n)})()}maxKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){let n=undefined;t._truncated||(n=yield t._parent.maxKey(e));for(;n!==undefined&&t._removed.has(n);){const r=KeyRange.upperBound(n,!0);n=yield t._parent.maxKey(r);if(null!==e&&!e.includes(n)){n=undefined;break}}for(const r of t._modified.keys())(null===e||e.includes(r))&&(n===undefined||ComparisonUtils.compare(r,n)>0)&&(n=r);return n})()}minValue(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){const n=yield t.minKey(e);return t.get(n)})()}minKey(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){let n=undefined;t._truncated||(n=yield t._parent.minKey(e));for(;n!==undefined&&t._removed.has(n);){const r=KeyRange.lowerBound(n,!0);n=yield t._parent.minKey(r);if(null!==e&&!e.includes(n)){n=undefined;break}}for(const r of t._modified.keys())(null===e||e.includes(r))&&(n===undefined||r<n)&&(n=r);return n})()}count(e=null){var t=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield t.keys(e)).size})()}index(e){return this._indices.get(e)}close(){return this.abort()}transaction(e=!0){if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");const t=new Transaction(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}synchronousTransaction(e=!0){if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");const t=new SynchronousTransaction(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}isSynchronous(){return!1}snapshot(){if(this.state!==Transaction.STATE.COMMITTED){const e=this._managingBackend.snapshot();e.inherit(this);return e}return this._snapshotManager.createSnapshot(this._objectStore,this)}toString(){return`Transaction{id=${this._id}, changes=${this._modified.size+this._removed.size}, truncated=${this._truncated}, objectStore=${this._objectStore}, state=${this._state}, dependency=${this._dependency}}`}toStringShort(){return`Transaction{id=${this._id}, changes=${this._modified.size+this._removed.size}, truncated=${this._truncated}, state=${this._state}, dependency=${this._dependency}}`}commit(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(e!==undefined){if(!t._isCommittable(e)){yield t.abort(e);return!1}yield t._commitInternal(e);return!0}if(null!==t._dependency)return t._dependency.commit();yield t._checkConstraints();return t._commitBackend()})()}abort(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(e!==undefined){if(e instanceof Snapshot)return t._snapshotManager.abortSnapshot(e);if(!t._nested.has(e)||e.state!==Transaction.STATE.OPEN)throw new Error("Can only abort open, nested transactions");t._nested["delete"](e);if(0===t._nested.size){t._state=Transaction.STATE.OPEN;t._nestedCommitted=!1}return!0}return null!==t._dependency?t._dependency.abort():t._abortBackend()})()}_apply(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(!(e instanceof Transaction))throw new Error("Can only apply transactions");yield t._snapshotManager.applyTx(e,t);t._applySync(e)})()}_commitBackend(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(e._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed or in nested state");e._enableWatchdog&&clearTimeout(e._watchdog);const t=Date.now();if(yield e._managingBackend.commit(e)){e._state=Transaction.STATE.COMMITTED;e._performanceCheck(t,"commit");e._performanceCheck();return!0}e._state=Transaction.STATE.CONFLICTED;e._performanceCheck(t,"commit");e._performanceCheck();return!1})()}_performanceCheck(e=this._startTime,t=null){const n=Date.now()-e;t=t?` function '${t}'`:"";n>Transaction.WATCHDOG_TIMER&&Log.w(Transaction,`Violation: tx id ${this._id}${t} took ${(n/1e3).toFixed(2)}s (${this.toString()}).`)}_isCommittable(e){if(e!==undefined){if(!this._nested.has(e)||e.state!==Transaction.STATE.OPEN)throw new Error("Can only commit open, nested transactions");return!this._nestedCommitted}return this._managingBackend._isCommittable(this)}_commitInternal(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){t._nested["delete"](e);t._nestedCommitted=!0;yield t._apply(e);if(0===t._nested.size){t._state=Transaction.STATE.OPEN;t._nestedCommitted=!1}})()}_setParent(e){this._parent=e}_abortBackend(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(e._state===Transaction.STATE.ABORTED||e._state===Transaction.STATE.CONFLICTED)return!0;if(e._state!==Transaction.STATE.OPEN&&e._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");e._state===Transaction.STATE.NESTED&&(yield Promise.all(Array.from(e._nested).map(function(e){return e.abort()})));e._enableWatchdog&&clearTimeout(e._watchdog);const t=Date.now();yield e._managingBackend.abort(e);e._setAborted();e._performanceCheck(t,"abort");e._performanceCheck();return!0})()}_setAborted(){this._state=Transaction.STATE.ABORTED}_put(e,t){this._removed["delete"](e);const n=this._modified.get(e);this._modified.set(e,t);for(const r of this._indices.values())r.put(e,t,n)}_remove(e){this._removed.add(e);const t=this._modified.get(e);this._modified["delete"](e);for(const n of this._indices.values())n.remove(e,t)}_checkConstraints(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){const t=[];for(const r of e._indices.values())if(r.unique)for(const[n,o]of e._modified)t.push(r.checkUniqueConstraint(n,o));if(t.length>0)try{yield Promise.all(t)}catch(n){yield e.abort();throw n}})()}decode(e,t){return this._objectStore.decode(e,t)}encode(e){return this._objectStore.encode(e)}}Transaction.WATCHDOG_TIMER=5e3;Transaction.STATE={OPEN:0,COMMITTED:1,ABORTED:2,CONFLICTED:3,NESTED:4};Transaction._instanceCount=0;Class.register(Transaction);class SynchronousTransaction extends Transaction{constructor(e,t,n,r=!0){super(e,t,n,r);this._cache=new Map}preload(e){e=e.filter(e=>!this.isCached(e));return Promise.all(e.map(e=>this.get(e)))}isCached(e){return this._cache.has(e)||!!this._parent.isSynchronous()&&this._parent.isCached(e)}get(e,t={}){var n=this;return(0,_asyncToGenerator3["default"])(function*(){t.expectPresence=!1;let r;if(n.isCached(e))r=n.getSync(e,t);else{r=yield Transaction.prototype.get.call(n,e,t);t&&t.raw?n._cache.set(e,n.decode(r,e)):n._cache.set(e,r)}return r})()}_getCached(e,t={}){const{expectPresence:n=!0}=t||{};let r=this._cache.get(e);if(!r&&this._parent.isSynchronous())return this._parent.getSync(e,t);if(n&&!r)throw new Error(`Missing key in cache: ${e}`);t&&t.raw&&(r=this.encode(r));return r}getSync(e,t={}){return this._removed.has(e)?undefined:this._modified.has(e)?t&&t.raw?this.encode(this._modified.get(e)):this._modified.get(e):this._truncated?undefined:this._getCached(e,t)}isSynchronous(){return!0}}Class.register(SynchronousTransaction);class Snapshot extends Transaction{constructor(e,t){super(e,t,e,!1)}inherit(e){if(!(e instanceof Transaction))throw new Error("Can only inherit transactions");return super._applySync(e)}_apply(e){var t=this;return(0,_asyncToGenerator3["default"])(function*(){if(!(e instanceof Transaction))throw new Error("Can only apply transactions");e._truncated&&(yield t.valueStream(function(e,n){t._modified.has(n)||t._put(n,e);return!0}));for(const[n,r]of e._modified){if(t._modified.has(n))continue;let e=yield t.get(n);e?t._put(n,e,r):t._remove(n,r)}for(const n of e._removed){if(t._modified.has(n))continue;let e=yield t.get(n);t._put(n,e)}})()}truncate(){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Unsupported operation on snapshots: truncate")})()}truncateSync(){throw new Error("Unsupported operation on snapshots: truncateSync")}commit(e){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Cannot commit snapshots: commit")})()}_isCommittable(e){return!1}_commitInternal(e){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Cannot commit snapshots")})()}_commitBackend(){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Cannot commit snapshots")})()}abort(e){return this._abortBackend()}_abortBackend(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(e._state!==Transaction.STATE.OPEN)throw new Error("Snapshot already closed");if(!(yield e._managingBackend.abort(e)))return!1;e._state=Transaction.STATE.ABORTED;e._truncated=!0;e._modified.clear();e._removed.clear();for(const t of e._indices.values())t.truncate();return!0})()}put(e,t){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Unsupported operation on snapshots: put")})()}putSync(e,t){throw new Error("Unsupported operation on snapshots: putSync")}remove(e){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Unsupported operation on snapshots: remove")})()}removeSync(e){throw new Error("Unsupported operation on snapshots: removeSync")}close(){return this.abort()}transaction(){throw new Error("Unsupported operation on snapshots: transaction")}synchronousTransaction(){throw new Error("Unsupported operation on snapshots: synchronousTransaction")}snapshot(){throw new Error("Unsupported operation on snapshots: snapshot")}}Class.register(Snapshot);class SnapshotManager{constructor(){this._snapshots=new Set}createSnapshot(e,t){const n=new Snapshot(e,t);this._snapshots.add(n);return n}abortSnapshot(e){return this._snapshots["delete"](e)}applyTx(e,t){var n=this;return(0,_asyncToGenerator3["default"])(function*(){if(!(e instanceof Transaction))throw new Error("Can only apply transactions");const r=[];for(const t of n._snapshots)r.push(t._apply(e));for(const o of e._snapshotManager){o._backend=t;n._snapshots.add(o)}return Promise.all(r)})()}[Symbol.iterator](){return this._snapshots.values()}}Class.register(SnapshotManager);class CombinedTransaction{constructor(...e){if(!this.isConsistent(e))throw new Error("Given set of transactions violates rules for combined transactions");this._transactions=e;this._flushable=new Map;this._preprocessing=[];this._dependency=this}get backend(){return this._jdb}get transactions(){return this._transactions}isConsistent(e){const t=new Set;this._jdb=null;for(const n of e){if(n.state!==Transaction.STATE.OPEN)return!1;if(n.nested)return!1;if(t.has(n._objectStore))return!1;if(null===this._jdb)this._jdb=n._objectStore.jungleDB;else if(this._jdb!==n._objectStore.jungleDB&&null!==n._objectStore.jungleDB)return!1;t.add(n._objectStore)}return!0}onFlushable(e,t=null,n=null){var r=this;return(0,_asyncToGenerator3["default"])(function*(){r._flushable.set(e,t);null!==n&&r._preprocessing.push(n);if(r._transactions.every(function(e){return r._flushable.has(e)})){const e=[];for(const t of r._preprocessing)e.push(t());yield Promise.all(e);yield JungleDB.commitCombined(r);for(const t of r._flushable.values())t();return!0}return!1})()}commit(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){if(e._isCommittable()){yield e._checkConstraints();yield e._commitBackend();return!0}yield e.abort();return!1})()}abort(){return this._abortBackend()}_abortBackend(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield Promise.all(e._transactions.map(function(e){return e._abortBackend()}))).every(function(e){return e})})()}transaction(e){throw new Error("Unsupported operation")}snapshot(){throw new Error("Unsupported operation")}_isCommittable(){return this._transactions.every(e=>e._isCommittable())}_checkConstraints(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){try{yield Promise.all(e._transactions.map(function(e){return e._checkConstraints()}))}catch(t){yield e.abort();throw t}})()}_commitBackend(){var e=this;return(0,_asyncToGenerator3["default"])(function*(){return(yield Promise.all(e._transactions.map(function(e){return e._commitBackend()}))).every(function(e){return e})})()}_commitInternal(e){return(0,_asyncToGenerator3["default"])(function*(){throw new Error("Cannot commit transactions to a combined transaction")})()}_setParent(e){throw new Error("Unsupported operation")}set _dependency(e){for(const t of this._transactions)t._dependency=e}get dependency(){return this}get objectStore(){throw new Error("Unsupported operation")}toString(){return`CombinedTransaction{size=${this._transactions.length}, states=[${this._transactions.map(e=>e.state)}]}`}}Class.register(CombinedTransaction);e._loaded=!0;"function"==typeof e._onload&&e._onload()}(JDB);
//# sourceMappingURL=indexeddb-babel.js.map
